<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>HUNTER SYSTEM</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { 'orbitron': ['Orbitron'], 'mono': ['JetBrains Mono'] },
        }
      }
    }
  </script>
  <style>
    * { -webkit-tap-highlight-color: transparent; }
    body { font-family: 'JetBrains Mono', monospace; background: #050508; }
    .glass { background: rgba(10, 10, 15, 0.85); backdrop-filter: blur(20px); }
    .neon-border { box-shadow: 0 0 10px rgba(6, 182, 212, 0.3), inset 0 0 10px rgba(6, 182, 212, 0.05); }
    .neon-text { text-shadow: 0 0 10px currentColor, 0 0 20px currentColor; }
    .hp-bar { background: linear-gradient(90deg, #dc2626, #ef4444, #f87171); box-shadow: 0 0 15px rgba(239, 68, 68, 0.5); }
    .xp-bar { background: linear-gradient(90deg, #7c3aed, #8b5cf6, #a78bfa); box-shadow: 0 0 15px rgba(124, 58, 237, 0.5); }
    @keyframes arise { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes glow { 0%, 100% { box-shadow: 0 0 5px currentColor; } 50% { box-shadow: 0 0 20px currentColor, 0 0 30px currentColor; } }
    @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
    @keyframes pulse-border { 0%, 100% { border-color: rgba(6, 182, 212, 0.3); } 50% { border-color: rgba(6, 182, 212, 0.8); } }
    @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
    @keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
    .animate-arise { animation: arise 0.4s ease-out forwards; opacity: 0; }
    .animate-float { animation: float 3s ease-in-out infinite; }
    .animate-glow { animation: glow 2s ease-in-out infinite; }
    .animate-pulse-border { animation: pulse-border 2s ease-in-out infinite; }
    .animate-shake { animation: shake 0.5s ease-in-out; }
    .tab-enter { animation: slideIn 0.3s ease-out; }
    .stagger-1 { animation-delay: 0.05s; } .stagger-2 { animation-delay: 0.1s; } .stagger-3 { animation-delay: 0.15s; }
    .stagger-4 { animation-delay: 0.2s; } .stagger-5 { animation-delay: 0.25s; }
    ::-webkit-scrollbar { width: 4px; } ::-webkit-scrollbar-track { background: #0a0a0f; }
    ::-webkit-scrollbar-thumb { background: rgba(6, 182, 212, 0.3); border-radius: 2px; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const Icon = ({ name, size = 24, className = "" }) => {
      const ref = useRef(null);
      useEffect(() => {
        if (ref.current && lucide.icons[name]) {
          ref.current.innerHTML = '';
          const icon = lucide.createElement(lucide.icons[name]);
          icon.setAttribute('width', size);
          icon.setAttribute('height', size);
          ref.current.appendChild(icon);
        }
      }, [name, size]);
      return <span ref={ref} className={`inline-flex ${className}`} style={{verticalAlign: 'middle'}} />;
    };

    const Notification = ({ message, type, onClose }) => {
      useEffect(() => { const t = setTimeout(onClose, 3000); return () => clearTimeout(t); }, []);
      const colors = { info: 'border-cyan-500/50 text-cyan-400', success: 'border-green-500/50 text-green-400', 
        warning: 'border-amber-500/50 text-amber-400', danger: 'border-red-500/50 text-red-400' };
      return (
        <div className={`fixed top-4 left-1/2 -translate-x-1/2 z-[100] px-6 py-3 rounded-lg border glass ${colors[type]} font-orbitron text-sm animate-arise`}>
          {message}
        </div>
      );
    };

    function App() {
      const [tab, setTab] = useState('home');
      const [notif, setNotif] = useState(null);
      const [showStudyForm, setShowStudyForm] = useState(false);
      const [showReviewForm, setShowReviewForm] = useState(false);
      const [showTaskForm, setShowTaskForm] = useState(false);
      const [showEscalaForm, setShowEscalaForm] = useState(false);
      const [showPunishment, setShowPunishment] = useState(false);
      const [selectedSubject, setSelectedSubject] = useState(null);
      const [selectedNewSubject, setSelectedNewSubject] = useState('');
      const [selectedReview, setSelectedReview] = useState(null);
      const [expandedItem, setExpandedItem] = useState(null);
      const [expandedTask, setExpandedTask] = useState(null);
      const [currentMonth, setCurrentMonth] = useState(new Date());
      const [selectedEscalaDate, setSelectedEscalaDate] = useState(null);
      const [escalaType, setEscalaType] = useState('branca');
      const [holdingDelete, setHoldingDelete] = useState(null);
      const [holdProgress, setHoldProgress] = useState(0);
      const holdTimer = useRef(null);
      const [formData, setFormData] = useState({ topic: '', minutes: '', confidence: 3, notes: '' });
      const [taskForm, setTaskForm] = useState({ title: '', details: '', deadline: '' });

      const INTERVALS = [1, 7, 15, 30, 45];
      const subjects = ['Comunicação e Expressão','Didática','Lógica','Metodologia Científica','Psicologia',
        'Chefia e Liderança','Escrituração Profissional','Tecnologia da Informação e Comunicação',
        'Gestão Contemporânea','Gestão de Pessoas','Direito Administrativo',
        'Direito Administrativo Disciplinar Militar','Direito Penal','Direito Penal Militar','Doutrina de Polícia Ostensiva'];
      
      const ranks = [
        { name: 'E', minXp: 0, maxXp: 299, color: '#6B7280', title: 'Caçador Iniciante' },
        { name: 'D', minXp: 300, maxXp: 799, color: '#10B981', title: 'Caçador Promissor' },
        { name: 'C', minXp: 800, maxXp: 1799, color: '#3B82F6', title: 'Caçador Competente' },
        { name: 'B', minXp: 1800, maxXp: 3499, color: '#8B5CF6', title: 'Caçador de Elite' },
        { name: 'A', minXp: 3500, maxXp: 5999, color: '#EF4444', title: 'Caçador Nacional' },
        { name: 'S', minXp: 6000, maxXp: Infinity, color: '#F59E0B', title: 'Shadow Monarch' },
      ];

      const [data, setData] = useState({ sessions: [], items: [], xp: 0, hp: 100, level: 1, pushUpDebt: 0, lastStudy: null });
      const [exercise, setExercise] = useState({ history: [], streak: 0, best: 0, total: 0 });
      const [tasks, setTasks] = useState([]);
      const [escalas, setEscalas] = useState({});

      useEffect(() => {
        const s = localStorage.getItem('hunter-system-v1');
        if (s) { const p = JSON.parse(s); setData(p.data || data); setExercise(p.exercise || exercise); setTasks(p.tasks || []); setEscalas(p.escalas || {}); }
      }, []);

      useEffect(() => {
        localStorage.setItem('hunter-system-v1', JSON.stringify({ data, exercise, tasks, escalas }));
      }, [data, exercise, tasks, escalas]);

      useEffect(() => { checkPenalties(); }, []);

      const notify = (msg, type = 'info') => setNotif({ message: msg, type });
      const getToday = () => new Date().toISOString().split('T')[0];
      const addDays = (d, n) => { const dt = new Date(d); dt.setDate(dt.getDate() + n); return dt.toISOString().split('T')[0]; };
      const isOnDuty = (d) => escalas[d] !== undefined;
      const formatDate = (d) => new Date(d + 'T00:00:00').toLocaleDateString('pt-BR', { day: '2-digit', month: 'short' });
      const daysUntil = (d) => Math.ceil((new Date(d + 'T00:00:00') - new Date(getToday() + 'T00:00:00')) / 86400000);

      const checkPenalties = () => {
        const today = getToday();
        const yest = addDays(today, -1);
        let loss = 0;
        if (data.lastStudy && data.lastStudy !== today && data.lastStudy !== yest && !isOnDuty(yest)) loss += 10;
        const lastEx = exercise.history.find(h => h.date === yest);
        if (!lastEx?.completed && !isOnDuty(yest)) loss += 10;
        if (loss > 0) applyDamage(loss);
      };

      const applyDamage = (dmg) => {
        setData(p => {
          const newHP = Math.max(0, p.hp - dmg);
          if (newHP === 0 && p.level > 1) {
            notify('HP ZERADO! LEVEL DOWN!', 'danger');
            if (navigator.vibrate) navigator.vibrate([200, 100, 200]);
            return { ...p, hp: 100, level: p.level - 1, xp: Math.max(0, p.xp - 300) };
          }
          return { ...p, hp: newHP };
        });
      };

      const healHP = (amt) => setData(p => ({ ...p, hp: Math.min(100, p.hp + amt) }));

      const getRank = (xp) => ranks.find(r => xp >= r.minXp && xp <= r.maxXp) || ranks[0];
      const getNextRank = (xp) => { const i = ranks.findIndex(r => xp >= r.minXp && xp <= r.maxXp); return ranks[i + 1] || null; };
      const rank = getRank(data.xp);
      const nextRank = getNextRank(data.xp);
      const xpToNext = nextRank ? nextRank.minXp - data.xp : 0;
      const progress = nextRank ? ((data.xp - rank.minXp) / (rank.maxXp - rank.minXp + 1)) * 100 : 100;

      const getPending = () => data.items.filter(i => i.nextReview <= getToday()).sort((a,b) => new Date(a.nextReview) - new Date(b.nextReview));
      const getUpcoming = () => data.items.filter(i => i.nextReview > getToday()).sort((a,b) => new Date(a.nextReview) - new Date(b.nextReview));
      const getStats = (subj) => {
        const sess = data.sessions.filter(s => s.subject === subj);
        const items = data.items.filter(i => i.subject === subj);
        return { sess, items, hours: (sess.reduce((a,s) => a + s.minutes, 0) / 60).toFixed(1) };
      };

      const addStudy = () => {
        if (!formData.topic.trim() || !formData.minutes || !selectedNewSubject) return;
        const today = getToday();
        const item = { id: Date.now(), subject: selectedNewSubject, topic: formData.topic, date: today, stage: 0, nextReview: addDays(today, INTERVALS[0]), reviews: [], conf: formData.confidence, mins: parseInt(formData.minutes), notes: formData.notes };
        const sess = { id: Date.now(), subject: selectedNewSubject, topic: formData.topic, minutes: parseInt(formData.minutes), confidence: formData.confidence, date: new Date().toISOString(), type: 'new' };
        setData(p => ({ ...p, sessions: [sess, ...p.sessions], items: [item, ...p.items], xp: p.xp + 50, lastStudy: today }));
        healHP(10);
        setFormData({ topic: '', minutes: '', confidence: 3, notes: '' });
        setSelectedNewSubject('');
        setShowStudyForm(false);
        notify('+50 XP | +10 HP', 'success');
        if (navigator.vibrate) navigator.vibrate(50);
      };

      const completeReview = () => {
        if (!formData.minutes || !selectedReview) return;
        const today = getToday();
        const nextStage = selectedReview.stage + 1;
        const nextInt = nextStage < INTERVALS.length ? INTERVALS[nextStage] : 45;
        setData(p => ({
          ...p,
          sessions: [{ id: Date.now(), subject: selectedReview.subject, topic: `Revisão: ${selectedReview.topic}`, minutes: parseInt(formData.minutes), confidence: formData.confidence, date: new Date().toISOString(), type: 'review' }, ...p.sessions],
          items: p.items.map(i => i.id === selectedReview.id ? { ...i, stage: nextStage, nextReview: addDays(today, nextInt), reviews: [...i.reviews, { date: today, conf: formData.confidence, mins: parseInt(formData.minutes) }] } : i),
          xp: p.xp + 40, lastStudy: today,
        }));
        healHP(5);
        setFormData({ topic: '', minutes: '', confidence: 3, notes: '' });
        setSelectedReview(null);
        setShowReviewForm(false);
        notify('+40 XP | +5 HP', 'success');
        if (navigator.vibrate) navigator.vibrate(50);
      };

      const skipReview = () => {
        applyDamage(5);
        setData(p => ({ ...p, xp: Math.max(0, p.xp - 25), pushUpDebt: p.pushUpDebt + 20 }));
        setShowPunishment(true);
        notify('-25 XP | -5 HP | +20 FLEXÕES', 'danger');
        if (navigator.vibrate) navigator.vibrate([100, 50, 100]);
      };

      const completePushUps = () => {
        setData(p => ({ ...p, pushUpDebt: 0, xp: p.xp + 10 }));
        healHP(5);
        notify('PUNIÇÃO COMPLETA! +10 XP', 'success');
        setTimeout(() => setShowPunishment(false), 1500);
      };

      const toggleExercise = (date) => {
        if (isOnDuty(date)) { notify('SERVIÇO - STREAK CONGELADO', 'warning'); return; }
        const idx = exercise.history.findIndex(h => h.date === date);
        let hist;
        let xpChg = 0;
        if (idx >= 0) {
          const was = exercise.history[idx].completed;
          hist = [...exercise.history];
          hist[idx] = { ...hist[idx], completed: !was };
          xpChg = was ? -40 : 40;
          if (!was) healHP(10);
        } else {
          hist = [{ date, completed: true }, ...exercise.history];
          xpChg = 40;
          healHP(10);
        }
        hist.sort((a,b) => new Date(b.date) - new Date(a.date));
        let streak = 0;
        const today = getToday();
        for (let i = 0; i < 100; i++) {
          const d = addDays(today, -i);
          if (isOnDuty(d)) continue;
          const e = hist.find(h => h.date === d);
          if (e?.completed) streak++; else break;
        }
        setExercise(p => ({ history: hist, streak, best: Math.max(p.best, streak), total: hist.filter(h => h.completed).length }));
        setData(p => ({ ...p, xp: Math.max(0, p.xp + xpChg) }));
        if (xpChg > 0) { notify('+40 XP | +10 HP', 'success'); if (navigator.vibrate) navigator.vibrate(50); }
      };

      const getLast30 = () => {
        const days = [];
        const today = new Date();
        for (let i = 29; i >= 0; i--) {
          const d = new Date(today); d.setDate(d.getDate() - i);
          const ds = d.toISOString().split('T')[0];
          const e = exercise.history.find(h => h.date === ds);
          days.push({ date: ds, done: e?.completed || false, duty: isOnDuty(ds), dow: d.toLocaleDateString('pt-BR', { weekday: 'short' }).charAt(0).toUpperCase(), day: d.getDate() });
        }
        return days;
      };

      const todayDone = () => exercise.history.find(h => h.date === getToday())?.completed || false;

      const addTask = () => {
        if (!taskForm.title.trim()) return;
        setTasks(p => [{ id: Date.now(), ...taskForm, completed: false }, ...p]);
        setTaskForm({ title: '', details: '', deadline: '' });
        setShowTaskForm(false);
        notify('MISSÃO CRIADA', 'info');
      };

      const toggleTask = (id) => {
        setTasks(p => p.map(t => {
          if (t.id === id) {
            if (!t.completed) { setData(d => ({ ...d, xp: d.xp + 25 })); healHP(5); notify('+25 XP', 'success'); if (navigator.vibrate) navigator.vibrate(50); }
            else { setData(d => ({ ...d, xp: Math.max(0, d.xp - 25) })); }
            return { ...t, completed: !t.completed };
          }
          return t;
        }));
      };

      const startHoldDel = (id) => {
        setHoldingDelete(id);
        setHoldProgress(0);
        let prog = 0;
        holdTimer.current = setInterval(() => {
          prog += 5;
          setHoldProgress(prog);
          if (prog >= 100) {
            clearInterval(holdTimer.current);
            setTasks(p => p.filter(t => t.id !== id));
            setHoldingDelete(null);
            setHoldProgress(0);
            notify('MISSÃO ELIMINADA', 'warning');
            if (navigator.vibrate) navigator.vibrate([50, 50, 50]);
          }
        }, 100);
      };

      const stopHoldDel = () => { if (holdTimer.current) clearInterval(holdTimer.current); setHoldingDelete(null); setHoldProgress(0); };

      const getTaskStatus = (t) => {
        if (t.completed) return 'done';
        if (!t.deadline) return 'pending';
        const today = new Date(); today.setHours(0,0,0,0);
        const dl = new Date(t.deadline);
        if (dl < today) return 'overdue';
        if ((dl - today) / 86400000 <= 2) return 'urgent';
        return 'pending';
      };

      const sortedTasks = [...tasks].sort((a,b) => { if (a.completed !== b.completed) return a.completed ? 1 : -1; if (a.deadline && b.deadline) return new Date(a.deadline) - new Date(b.deadline); return 0; });

      const getMonthDays = (date) => {
        const y = date.getFullYear(), m = date.getMonth();
        const first = new Date(y, m, 1), last = new Date(y, m + 1, 0);
        const days = [];
        for (let i = 0; i < first.getDay(); i++) days.push(null);
        for (let i = 1; i <= last.getDate(); i++) {
          const d = new Date(y, m, i);
          days.push({ day: i, date: d.toISOString().split('T')[0], dow: d.getDay() });
        }
        return days;
      };

      const getEscalaColor = (t) => {
        switch(t) {
          case 'branca': return 'bg-slate-200 text-slate-900 border-slate-400';
          case 'preta': return 'bg-slate-900 text-white border-slate-600';
          case 'vermelha': return 'bg-red-600 text-white border-red-500';
          case 'roxa': return 'bg-purple-600 text-white border-purple-500';
          default: return 'bg-slate-800 text-slate-400 border-slate-700';
        }
      };

      const addEscala = () => {
        if (!selectedEscalaDate) return;
        setEscalas(p => ({ ...p, [selectedEscalaDate]: escalaType }));
        setShowEscalaForm(false);
        setSelectedEscalaDate(null);
        notify('ESCALA REGISTRADA', 'success');
      };

      const removeEscala = (d) => { setEscalas(p => { const n = {...p}; delete n[d]; return n; }); notify('ESCALA REMOVIDA', 'warning'); };

      const countEscalas = () => {
        const y = currentMonth.getFullYear(), m = currentMonth.getMonth();
        const c = { branca: 0, preta: 0, vermelha: 0, roxa: 0 };
        Object.entries(escalas).forEach(([d, t]) => {
          const dt = new Date(d + 'T00:00:00');
          if (dt.getFullYear() === y && dt.getMonth() === m) c[t]++;
        });
        return c;
      };

      const pending = getPending();
      const upcoming = getUpcoming();
      const studied = [...new Set(data.items.map(i => i.subject))];

      const getStageName = (s) => ['1ª Rev (1d)', '2ª Rev (7d)', '3ª Rev (15d)', '4ª Rev (30d)', '5ª Rev (45d)'][s] || 'Manutenção';

      return (
        <div className="min-h-screen bg-[#050508] text-white">
          {notif && <Notification message={notif.message} type={notif.type} onClose={() => setNotif(null)} />}
          
          <div className="max-w-md mx-auto">
            {/* PUNISHMENT MODAL */}
            {showPunishment && data.pushUpDebt > 0 && (
              <div className="fixed inset-0 bg-black/90 flex items-center justify-center p-4 z-50">
                <div className="w-full max-w-md glass rounded-2xl p-6 border-2 border-red-500/50 animate-arise animate-pulse-border">
                  <div className="text-center mb-6">
                    <div className="w-20 h-20 mx-auto mb-4 rounded-full bg-red-500/20 flex items-center justify-center">
                      <Icon name="AlertTriangle" size={40} className="text-red-500" />
                    </div>
                    <h3 className="text-2xl font-orbitron font-black text-red-500 neon-text">PUNIÇÃO</h3>
                  </div>
                  <div className="bg-red-500/10 rounded-xl p-6 mb-6 border border-red-500/30 text-center">
                    <p className="text-slate-400 text-sm mb-2">DÍVIDA:</p>
                    <div className="text-6xl font-mono font-black text-red-500 neon-text">{data.pushUpDebt}</div>
                    <p className="text-xl font-orbitron text-red-400 mt-2">FLEXÕES</p>
                  </div>
                  <button onClick={completePushUps} className="w-full py-4 rounded-xl font-orbitron font-bold bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 transition-all">
                    CONCLUÍDO (+10 XP)
                  </button>
                  <button onClick={() => setShowPunishment(false)} className="w-full py-3 text-slate-500 text-sm mt-2">Depois</button>
                </div>
              </div>
            )}

            {/* HOME */}
            {tab === 'home' && (
              <div className="p-4 pb-24 space-y-4 tab-enter">
                {/* STATUS CARD */}
                <div className="glass rounded-2xl p-5 border border-cyan-500/30 neon-border">
                  <div className="flex items-start justify-between mb-4">
                    <div>
                      <div className="w-16 h-16 rounded-xl flex items-center justify-center text-3xl font-orbitron font-black mb-2 animate-float" style={{ backgroundColor: rank.color, boxShadow: `0 0 25px ${rank.color}` }}>
                        {rank.name}
                      </div>
                      <h2 className="text-lg font-orbitron font-black" style={{ color: rank.color }}>RANK {rank.name}</h2>
                      <p className="text-slate-500 text-xs">{rank.title}</p>
                      <p className="text-cyan-400 text-xs mt-1">LV {data.level}</p>
                    </div>
                    <div className="text-right">
                      <div className="flex items-center gap-1">
                        <Icon name="Zap" size={18} className="text-purple-400" />
                        <span className="text-2xl font-mono font-black text-purple-400">{data.xp}</span>
                      </div>
                      <p className="text-[10px] text-slate-500 font-orbitron">POWER</p>
                    </div>
                  </div>

                  {/* XP BAR */}
                  <div className="mb-3">
                    <div className="flex justify-between text-[10px] text-slate-500 mb-1 font-mono">
                      <span>XP</span>
                      <span>{nextRank ? `${xpToNext} → ${nextRank.name}` : 'MAX'}</span>
                    </div>
                    <div className="w-full bg-slate-800 rounded-full h-3 overflow-hidden">
                      <div className="xp-bar h-full rounded-full transition-all duration-1000" style={{ width: `${progress}%` }} />
                    </div>
                  </div>

                  {/* HP BAR */}
                  <div>
                    <div className="flex justify-between text-[10px] mb-1 font-mono">
                      <span className="text-red-400">HP</span>
                      <span className="text-red-400">{data.hp}/100</span>
                    </div>
                    <div className="w-full bg-slate-800/50 rounded-full h-3 overflow-hidden border border-red-500/30">
                      <div className={`hp-bar h-full rounded-full transition-all duration-500 ${data.hp <= 20 ? 'animate-pulse' : ''}`} style={{ width: `${data.hp}%` }} />
                    </div>
                    {data.hp <= 20 && <p className="text-red-500 text-[10px] mt-1 animate-pulse font-orbitron">⚠ HP CRÍTICO</p>}
                  </div>

                  {data.pushUpDebt > 0 && (
                    <button onClick={() => setShowPunishment(true)} className="w-full mt-4 py-3 rounded-xl bg-red-500/20 border border-red-500/50 flex items-center justify-center gap-2 hover:bg-red-500/30">
                      <Icon name="AlertTriangle" size={18} className="text-red-500" />
                      <span className="font-mono text-red-400">DÍVIDA: {data.pushUpDebt} FLEXÕES</span>
                    </button>
                  )}
                </div>

                {/* NEW STUDY BTN */}
                <button onClick={() => setShowStudyForm(true)} className="w-full rounded-xl p-4 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 transition-all shadow-lg shadow-cyan-500/25 flex items-center justify-center gap-3 group">
                  <Icon name="Plus" size={22} className="text-white group-hover:rotate-90 transition-transform" />
                  <span className="font-orbitron font-bold">NOVO ESTUDO</span>
                  <span className="text-cyan-200 text-sm">+50 XP</span>
                </button>

                {/* PENDING REVIEWS */}
                {pending.length > 0 && (
                  <div className="glass rounded-2xl p-4 border border-amber-500/30">
                    <div className="flex items-center gap-3 mb-4">
                      <div className="w-10 h-10 rounded-lg bg-amber-500/20 flex items-center justify-center">
                        <Icon name="Brain" size={22} className="text-amber-500" />
                      </div>
                      <div>
                        <h3 className="font-orbitron font-bold text-amber-400">REVISÕES</h3>
                        <p className="text-[10px] text-slate-500">Ebbinghaus</p>
                      </div>
                      <span className="ml-auto bg-amber-500 text-black text-sm font-mono font-bold px-3 py-1 rounded-full">{pending.length}</span>
                    </div>
                    <div className="space-y-3">
                      {pending.slice(0, 3).map((item, i) => {
                        const late = daysUntil(item.nextReview) < 0;
                        const daysLate = Math.abs(daysUntil(item.nextReview));
                        return (
                          <div key={item.id} className={`glass rounded-xl p-4 border animate-arise stagger-${i+1} ${late ? 'border-red-500/50' : 'border-amber-500/30'}`}>
                            <div className="flex items-start justify-between mb-2">
                              <div className="flex-1">
                                <p className="text-[10px] text-slate-500">{item.subject}</p>
                                <h4 className="font-bold text-white text-sm">{item.topic}</h4>
                              </div>
                              {late && <span className="bg-red-500 text-white text-[10px] font-mono px-2 py-1 rounded">{daysLate}d</span>}
                            </div>
                            <span className="text-[10px] bg-slate-700 text-slate-300 px-2 py-1 rounded font-mono">{getStageName(item.stage)}</span>
                            <div className="grid grid-cols-2 gap-2 mt-3">
                              <button onClick={() => { setSelectedReview(item); setShowReviewForm(true); }} className="py-2 rounded-lg font-bold text-sm bg-gradient-to-r from-amber-500 to-orange-500 flex items-center justify-center gap-1">
                                <Icon name="CheckCircle2" size={14} /> REVISAR
                              </button>
                              <button onClick={skipReview} className="py-2 rounded-lg font-bold text-sm bg-red-500/20 text-red-400 border border-red-500/30">PULAR</button>
                            </div>
                          </div>
                        );
                      })}
                      {pending.length > 3 && <p className="text-center text-sm text-amber-500 font-mono">+{pending.length - 3} pendentes</p>}
                    </div>
                  </div>
                )}

                {/* ALL CLEAR */}
                {pending.length === 0 && data.items.length > 0 && (
                  <div className="glass rounded-2xl p-6 border border-green-500/30 text-center">
                    <div className="w-16 h-16 mx-auto mb-4 bg-green-500/20 rounded-full flex items-center justify-center">
                      <Icon name="CheckCircle2" size={32} className="text-green-500" />
                    </div>
                    <h3 className="font-orbitron font-bold text-green-400">SISTEMA LIMPO</h3>
                    <p className="text-sm text-slate-500 mt-1">Próxima: {upcoming[0] ? formatDate(upcoming[0].nextReview) : '-'}</p>
                  </div>
                )}

                {/* EMPTY */}
                {data.items.length === 0 && (
                  <div className="glass rounded-2xl p-6 border border-slate-700 text-center">
                    <Icon name="BookOpen" size={32} className="mx-auto text-slate-500 mb-4" />
                    <h3 className="font-orbitron font-bold text-slate-400">INICIAR TREINO</h3>
                  </div>
                )}

                {/* STATS */}
                <div className="grid grid-cols-3 gap-3">
                  {[
                    { icon: 'Award', val: data.items.length, label: 'ESTUDOS', color: 'text-cyan-400' },
                    { icon: 'RefreshCw', val: data.sessions.filter(s => s.type === 'review').length, label: 'REVISÕES', color: 'text-amber-400' },
                    { icon: 'Flame', val: exercise.streak, label: 'STREAK', color: 'text-orange-400' },
                  ].map((s, i) => (
                    <div key={s.label} className={`glass rounded-xl p-3 border border-slate-700 animate-arise stagger-${i+1}`}>
                      <Icon name={s.icon} size={16} className={`${s.color} mb-1`} />
                      <p className="text-[10px] text-slate-500">{s.label}</p>
                      <p className={`text-xl font-mono font-black ${s.color}`}>{s.val}</p>
                    </div>
                  ))}
                </div>

                {/* UPCOMING */}
                {upcoming.length > 0 && (
                  <div className="glass rounded-xl p-4 border border-slate-700">
                    <h3 className="text-xs font-orbitron text-slate-400 mb-3 flex items-center gap-2">
                      <Icon name="Calendar" size={14} className="text-blue-400" /> PRÓXIMAS
                    </h3>
                    <div className="space-y-2">
                      {upcoming.slice(0, 3).map(item => {
                        const d = daysUntil(item.nextReview);
                        return (
                          <div key={item.id} className="flex items-center justify-between text-sm">
                            <div className="flex-1 truncate">
                              <span className="text-slate-300">{item.topic}</span>
                              <p className="text-[10px] text-slate-600">{item.subject}</p>
                            </div>
                            <span className={`text-xs font-mono px-2 py-1 rounded ml-2 ${d <= 1 ? 'bg-amber-500/20 text-amber-400' : 'bg-slate-700 text-slate-400'}`}>
                              {d === 0 ? 'HOJE' : d === 1 ? 'AMANHÃ' : `${d}d`}
                            </span>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                )}

                {/* NEW STUDY MODAL */}
                {showStudyForm && (
                  <div className="fixed inset-0 bg-black/90 flex items-center justify-center p-4 z-50">
                    <div className="w-full max-w-md glass rounded-2xl p-6 border border-cyan-500/30 animate-arise animate-pulse-border max-h-[90vh] overflow-y-auto">
                      <div className="flex items-center justify-between mb-6">
                        <h3 className="text-xl font-orbitron font-black text-cyan-400">NOVO ESTUDO</h3>
                        <button onClick={() => { setShowStudyForm(false); setSelectedNewSubject(''); }} className="w-10 h-10 rounded-lg bg-slate-800 flex items-center justify-center hover:bg-slate-700">
                          <Icon name="X" size={20} className="text-slate-400" />
                        </button>
                      </div>
                      <div className="space-y-4">
                        <div>
                          <label className="text-xs text-slate-500 mb-2 block font-orbitron">MATÉRIA</label>
                          <select value={selectedNewSubject} onChange={e => setSelectedNewSubject(e.target.value)} className="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white focus:border-cyan-500 focus:outline-none">
                            <option value="">Selecionar...</option>
                            {subjects.map(s => <option key={s} value={s}>{s}</option>)}
                          </select>
                        </div>
                        {selectedNewSubject && (
                          <>
                            <div className="bg-cyan-500/10 rounded-lg p-4 border border-cyan-500/30">
                              <p className="font-bold text-cyan-400">{selectedNewSubject}</p>
                              <p className="text-[10px] text-slate-500 mt-1 font-mono">1d→7d→15d→30d→45d</p>
                            </div>
                            <div>
                              <label className="text-xs text-slate-500 mb-2 block font-orbitron">TÓPICO *</label>
                              <input type="text" value={formData.topic} onChange={e => setFormData({ ...formData, topic: e.target.value })} placeholder="Ex: Crimes contra a pessoa" className="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white focus:border-cyan-500 focus:outline-none" />
                            </div>
                            <div>
                              <label className="text-xs text-slate-500 mb-2 block font-orbitron">TEMPO (MIN) *</label>
                              <input type="number" value={formData.minutes} onChange={e => setFormData({ ...formData, minutes: e.target.value })} placeholder="60" className="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white focus:border-cyan-500 focus:outline-none font-mono" />
                            </div>
                            <div>
                              <label className="text-xs text-slate-500 mb-2 block font-orbitron">CONFIANÇA</label>
                              <div className="flex gap-2">
                                {[1,2,3,4,5].map(l => (
                                  <button key={l} onClick={() => setFormData({ ...formData, confidence: l })} className={`flex-1 py-3 rounded-lg font-mono font-bold transition-all ${formData.confidence === l ? 'bg-cyan-500 text-white shadow-lg shadow-cyan-500/50' : 'bg-slate-800 text-slate-400'}`}>{l}</button>
                                ))}
                              </div>
                            </div>
                            <button onClick={addStudy} disabled={!formData.topic.trim() || !formData.minutes} className="w-full py-4 rounded-xl font-orbitron font-bold disabled:opacity-50 bg-gradient-to-r from-cyan-600 to-blue-600">
                              REGISTRAR (+50 XP)
                            </button>
                          </>
                        )}
                      </div>
                    </div>
                  </div>
                )}

                {/* REVIEW MODAL */}
                {showReviewForm && selectedReview && (
                  <div className="fixed inset-0 bg-black/90 flex items-center justify-center p-4 z-50">
                    <div className="w-full max-w-md glass rounded-2xl p-6 border border-amber-500/30 animate-arise animate-pulse-border max-h-[90vh] overflow-y-auto">
                      <div className="flex items-center justify-between mb-6">
                        <h3 className="text-xl font-orbitron font-black text-amber-400">REVISÃO</h3>
                        <button onClick={() => { setShowReviewForm(false); setSelectedReview(null); }} className="w-10 h-10 rounded-lg bg-slate-800 flex items-center justify-center hover:bg-slate-700">
                          <Icon name="X" size={20} className="text-slate-400" />
                        </button>
                      </div>
                      <div className="bg-amber-500/10 rounded-lg p-4 mb-6 border border-amber-500/30">
                        <p className="text-[10px] text-amber-500">{selectedReview.subject}</p>
                        <p className="text-lg font-bold text-amber-400">{selectedReview.topic}</p>
                        <span className="text-[10px] bg-amber-500/20 text-amber-400 px-2 py-1 rounded font-mono mt-2 inline-block">{getStageName(selectedReview.stage)}</span>
                      </div>
                      <div className="space-y-4">
                        <div>
                          <label className="text-xs text-slate-500 mb-2 block font-orbitron">TEMPO (MIN) *</label>
                          <input type="number" value={formData.minutes} onChange={e => setFormData({ ...formData, minutes: e.target.value })} placeholder="30" className="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white focus:border-amber-500 focus:outline-none font-mono" />
                        </div>
                        <div>
                          <label className="text-xs text-slate-500 mb-2 block font-orbitron">CONFIANÇA</label>
                          <div className="flex gap-2">
                            {[1,2,3,4,5].map(l => (
                              <button key={l} onClick={() => setFormData({ ...formData, confidence: l })} className={`flex-1 py-3 rounded-lg font-mono font-bold transition-all ${formData.confidence === l ? 'bg-amber-500 text-black shadow-lg shadow-amber-500/50' : 'bg-slate-800 text-slate-400'}`}>{l}</button>
                            ))}
                          </div>
                        </div>
                        <button onClick={completeReview} disabled={!formData.minutes} className="w-full py-4 rounded-xl font-orbitron font-bold disabled:opacity-50 bg-gradient-to-r from-amber-500 to-orange-500 text-black">
                          COMPLETAR (+40 XP)
                        </button>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            )}

            {/* MATÉRIAS */}
            {tab === 'materias' && (
              <div className="p-4 pb-24 space-y-4 tab-enter">
                <h1 className="text-2xl font-orbitron font-black">MATÉRIAS</h1>
                <p className="text-slate-500 text-sm font-mono">{studied.length} estudadas • {data.items.length} tópicos</p>
                {subjects.map((subj, i) => {
                  const st = getStats(subj);
                  const exp = selectedSubject === subj;
                  const has = st.items.length > 0;
                  return (
                    <div key={subj} className={`glass rounded-xl border overflow-hidden animate-arise ${has ? 'border-slate-700' : 'border-slate-800 opacity-50'}`} style={{ animationDelay: `${i * 0.03}s` }}>
                      <button onClick={() => has && setSelectedSubject(exp ? null : subj)} className={`w-full p-4 flex items-center justify-between text-left ${has ? 'hover:bg-slate-800/50' : ''}`} disabled={!has}>
                        <div className="flex-1">
                          <h3 className="font-bold text-white text-sm">{subj}</h3>
                          <div className="flex gap-3 text-[10px] text-slate-500 mt-1 font-mono">
                            {has ? <><span>{st.items.length} tópicos</span><span>{st.hours}h</span></> : <span>Não iniciada</span>}
                          </div>
                        </div>
                        {has && <Icon name="ChevronDown" size={16} className={`text-slate-500 transition-transform ${exp ? 'rotate-180' : ''}`} />}
                      </button>
                      {exp && st.items.length > 0 && (
                        <div className="border-t border-slate-800 p-4 space-y-2">
                          {st.items.map(item => {
                            const itemExp = expandedItem === item.id;
                            const d = daysUntil(item.nextReview);
                            return (
                              <div key={item.id} className="glass rounded-lg p-3 border border-slate-700 cursor-pointer hover:border-slate-600" onClick={() => setExpandedItem(itemExp ? null : item.id)}>
                                <div className="flex items-start justify-between">
                                  <div className="flex-1">
                                    <h5 className="font-medium text-white text-sm">{item.topic}</h5>
                                    <p className="text-[10px] text-slate-500 mt-1 font-mono">{formatDate(item.date)} • {item.reviews.length} rev</p>
                                  </div>
                                  <span className={`text-[10px] px-2 py-1 rounded font-mono ${d < 0 ? 'bg-red-500/20 text-red-400' : d === 0 ? 'bg-amber-500/20 text-amber-400' : 'bg-blue-500/20 text-blue-400'}`}>
                                    {d < 0 ? `${Math.abs(d)}d atraso` : d === 0 ? 'HOJE' : `${d}d`}
                                  </span>
                                </div>
                                {itemExp && (
                                  <div className="mt-3 pt-3 border-t border-slate-700 text-[10px] space-y-1">
                                    <p className="text-slate-400"><span className="text-cyan-400">Próxima:</span> {getStageName(item.stage)}</p>
                                    {item.reviews.map((r, idx) => <p key={idx} className="text-slate-500 font-mono">{formatDate(r.date)} - {r.mins}min - {r.conf}/5</p>)}
                                  </div>
                                )}
                              </div>
                            );
                          })}
                        </div>
                      )}
                    </div>
                  );
                })}
              </div>
            )}

            {/* ESCALAS */}
            {tab === 'escalas' && (
              <div className="p-4 pb-24 space-y-4 tab-enter">
                <div className="flex items-center justify-between">
                  <h1 className="text-2xl font-orbitron font-black">ESCALAS</h1>
                  <button onClick={() => { setShowEscalaForm(true); setSelectedEscalaDate(null); }} className="w-10 h-10 rounded-lg bg-cyan-600 flex items-center justify-center shadow-lg shadow-cyan-500/25">
                    <Icon name="Plus" size={20} />
                  </button>
                </div>
                <div className="glass rounded-xl p-4 border border-slate-700">
                  <div className="flex items-center justify-between mb-4">
                    <button onClick={() => setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1, 1))} className="w-10 h-10 rounded-lg bg-slate-800 flex items-center justify-center hover:bg-slate-700">
                      <Icon name="ChevronLeft" size={18} className="text-slate-400" />
                    </button>
                    <h2 className="font-orbitron font-bold capitalize">{currentMonth.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' })}</h2>
                    <button onClick={() => setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 1))} className="w-10 h-10 rounded-lg bg-slate-800 flex items-center justify-center hover:bg-slate-700">
                      <Icon name="ChevronRight" size={18} className="text-slate-400" />
                    </button>
                  </div>
                  <div className="grid grid-cols-7 gap-1 mb-2">
                    {['D','S','T','Q','Q','S','S'].map((d, i) => <div key={i} className="text-center text-[10px] font-mono text-slate-500 py-1">{d}</div>)}
                  </div>
                  <div className="grid grid-cols-7 gap-1">
                    {getMonthDays(currentMonth).map((day, i) => {
                      if (!day) return <div key={`e-${i}`} className="aspect-square" />;
                      const esc = escalas[day.date];
                      const isToday = day.date === getToday();
                      return (
                        <button key={day.date} onClick={() => { if (esc) removeEscala(day.date); else { setSelectedEscalaDate(day.date); setShowEscalaForm(true); }}} className={`aspect-square rounded-lg flex items-center justify-center text-xs font-mono font-bold transition-all border ${esc ? getEscalaColor(esc) : 'bg-slate-800/50 border-slate-700 text-slate-400 hover:bg-slate-700'} ${isToday ? 'ring-2 ring-cyan-500 ring-offset-1 ring-offset-[#050508]' : ''}`}>
                          {day.day}
                        </button>
                      );
                    })}
                  </div>
                </div>
                <div className="glass rounded-xl p-4 border border-slate-700">
                  <h3 className="text-xs font-orbitron text-slate-500 mb-3">LEGENDA</h3>
                  <div className="grid grid-cols-2 gap-2">
                    {[{ t: 'branca', l: 'Dia Útil', c: 'bg-slate-200' }, { t: 'preta', l: 'Sexta', c: 'bg-slate-900 border border-slate-600' }, { t: 'vermelha', l: 'FDS', c: 'bg-red-600' }, { t: 'roxa', l: 'Feriado', c: 'bg-purple-600' }].map(x => (
                      <div key={x.t} className="flex items-center gap-2"><div className={`w-5 h-5 rounded ${x.c}`} /><span className="text-xs text-slate-400">{x.l}</span></div>
                    ))}
                  </div>
                  <p className="text-[10px] text-cyan-400 mt-3 font-mono">⚡ Serviço = streak congelado</p>
                </div>
                <div className="glass rounded-xl p-4 border border-slate-700">
                  <h3 className="text-xs font-orbitron text-slate-500 mb-3">RESUMO</h3>
                  <div className="grid grid-cols-4 gap-2">
                    {[{ t: 'branca', l: 'Úteis', c: 'text-slate-300' }, { t: 'preta', l: 'Sextas', c: 'text-slate-400' }, { t: 'vermelha', l: 'FDS', c: 'text-red-400' }, { t: 'roxa', l: 'Feriados', c: 'text-purple-400' }].map(x => (
                      <div key={x.t} className="text-center p-2 bg-slate-800/50 rounded-lg">
                        <p className={`text-xl font-mono font-black ${x.c}`}>{countEscalas()[x.t]}</p>
                        <p className="text-[9px] text-slate-500">{x.l}</p>
                      </div>
                    ))}
                  </div>
                </div>
                {showEscalaForm && (
                  <div className="fixed inset-0 bg-black/90 flex items-center justify-center p-4 z-50">
                    <div className="w-full max-w-md glass rounded-2xl p-6 border border-cyan-500/30 animate-arise animate-pulse-border">
                      <div className="flex items-center justify-between mb-6">
                        <h3 className="text-xl font-orbitron font-black text-cyan-400">NOVA ESCALA</h3>
                        <button onClick={() => { setShowEscalaForm(false); setSelectedEscalaDate(null); }} className="w-10 h-10 rounded-lg bg-slate-800 flex items-center justify-center hover:bg-slate-700">
                          <Icon name="X" size={20} className="text-slate-400" />
                        </button>
                      </div>
                      <div className="space-y-4">
                        <div>
                          <label className="text-xs text-slate-500 mb-2 block font-orbitron">DATA</label>
                          <input type="date" value={selectedEscalaDate || ''} onChange={e => setSelectedEscalaDate(e.target.value)} className="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white focus:border-cyan-500 focus:outline-none font-mono" />
                        </div>
                        <div>
                          <label className="text-xs text-slate-500 mb-2 block font-orbitron">TIPO</label>
                          <div className="grid grid-cols-2 gap-2">
                            {[{ t: 'branca', l: 'Dia Útil', c: 'bg-slate-200 text-slate-900' }, { t: 'preta', l: 'Sexta', c: 'bg-slate-900 text-white border border-slate-600' }, { t: 'vermelha', l: 'FDS', c: 'bg-red-600 text-white' }, { t: 'roxa', l: 'Feriado', c: 'bg-purple-600 text-white' }].map(x => (
                              <button key={x.t} onClick={() => setEscalaType(x.t)} className={`p-3 rounded-lg font-bold text-sm ${x.c} ${escalaType === x.t ? 'ring-2 ring-cyan-500 ring-offset-2 ring-offset-[#050508]' : ''}`}>{x.l}</button>
                            ))}
                          </div>
                        </div>
                        <button onClick={addEscala} disabled={!selectedEscalaDate} className="w-full py-4 rounded-xl font-orbitron font-bold disabled:opacity-50 bg-gradient-to-r from-cyan-600 to-blue-600">CONFIRMAR</button>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            )}

            {/* TREINO */}
            {tab === 'treino' && (
              <div className="p-4 pb-24 space-y-4 tab-enter">
                <h1 className="text-2xl font-orbitron font-black">TREINO</h1>
                <div className="glass rounded-2xl p-6 border border-slate-700">
                  <div className="text-center mb-4">
                    <p className="text-xs text-slate-500 mb-3 font-orbitron">HOJE</p>
                    <button onClick={() => toggleExercise(getToday())} className={`w-24 h-24 rounded-full flex items-center justify-center transition-all ${isOnDuty(getToday()) ? 'bg-purple-600/30 border-2 border-purple-500/50 cursor-not-allowed' : todayDone() ? 'bg-gradient-to-br from-green-500 to-emerald-600 shadow-lg shadow-green-500/50' : 'bg-slate-800 border-2 border-dashed border-slate-600 hover:border-cyan-500'}`}>
                      {isOnDuty(getToday()) ? <Icon name="Shield" size={40} className="text-purple-400" /> : todayDone() ? <Icon name="CheckCircle2" size={40} /> : <Icon name="Plus" size={40} className="text-slate-500" />}
                    </button>
                    <p className="mt-3 font-orbitron font-bold">{isOnDuty(getToday()) ? 'SERVIÇO' : todayDone() ? 'COMPLETO' : 'MARCAR'}</p>
                    {isOnDuty(getToday()) && <p className="text-[10px] text-purple-400 mt-1">Streak congelado</p>}
                  </div>
                </div>
                <div className="grid grid-cols-3 gap-3">
                  {[{ v: exercise.streak, l: 'STREAK', c: 'text-orange-400', e: '🔥' }, { v: exercise.best, l: 'RECORDE', c: 'text-purple-400', e: '👑' }, { v: exercise.total, l: 'TOTAL', c: 'text-cyan-400', e: '📊' }].map(s => (
                    <div key={s.l} className="glass rounded-xl p-3 border border-slate-700 text-center">
                      <p className={`text-2xl font-mono font-black ${s.c}`}>{s.v}{s.e}</p>
                      <p className="text-[9px] text-slate-500 font-orbitron">{s.l}</p>
                    </div>
                  ))}
                </div>
                <div className="glass rounded-xl p-4 border border-slate-700">
                  <h3 className="text-xs font-orbitron text-slate-500 mb-3">30 DIAS</h3>
                  <div className="grid grid-cols-7 gap-1">
                    {getLast30().map(day => (
                      <button key={day.date} onClick={() => toggleExercise(day.date)} disabled={day.duty} className={`aspect-square rounded-lg flex flex-col items-center justify-center text-[10px] font-mono transition-all ${day.duty ? 'bg-purple-600/30 text-purple-400 border border-purple-500/30' : day.done ? 'bg-green-500 text-white shadow-md shadow-green-500/30' : 'bg-slate-800 text-slate-500 hover:bg-slate-700'} ${day.date === getToday() ? 'ring-2 ring-cyan-500 ring-offset-1 ring-offset-[#050508]' : ''}`}>
                        <span className="opacity-70">{day.dow}</span>
                        <span className="font-bold">{day.day}</span>
                      </button>
                    ))}
                  </div>
                  <div className="flex items-center gap-4 mt-3 text-[10px]">
                    <div className="flex items-center gap-1"><div className="w-3 h-3 rounded bg-green-500" /><span className="text-slate-500">Treino</span></div>
                    <div className="flex items-center gap-1"><div className="w-3 h-3 rounded bg-purple-600/50" /><span className="text-slate-500">Serviço</span></div>
                  </div>
                </div>
              </div>
            )}

            {/* MISSÕES */}
            {tab === 'missoes' && (
              <div className="p-4 pb-24 space-y-4 tab-enter">
                <div className="flex items-center justify-between">
                  <div>
                    <h1 className="text-2xl font-orbitron font-black">MISSÕES</h1>
                    <p className="text-slate-500 text-sm font-mono">{tasks.filter(t => !t.completed).length} pendentes</p>
                  </div>
                  <button onClick={() => setShowTaskForm(true)} className="w-10 h-10 rounded-lg bg-cyan-600 flex items-center justify-center shadow-lg shadow-cyan-500/25">
                    <Icon name="Plus" size={20} />
                  </button>
                </div>
                {sortedTasks.length === 0 ? (
                  <div className="glass rounded-2xl p-8 border border-slate-700 text-center">
                    <Icon name="ListTodo" size={48} className="mx-auto text-slate-600 mb-4" />
                    <p className="text-slate-500 font-orbitron">NENHUMA MISSÃO</p>
                  </div>
                ) : (
                  <div className="space-y-3">
                    {sortedTasks.map((task, i) => {
                      const st = getTaskStatus(task);
                      const exp = expandedTask === task.id;
                      const holding = holdingDelete === task.id;
                      return (
                        <div key={task.id} className={`glass rounded-xl p-4 border transition-all animate-arise ${task.completed ? 'border-slate-800 opacity-50' : st === 'overdue' ? 'border-red-500/50' : st === 'urgent' ? 'border-amber-500/50' : 'border-slate-700'}`} style={{ animationDelay: `${i * 0.03}s` }}>
                          <div className="flex items-start gap-3">
                            <button onClick={() => toggleTask(task.id)} className={`mt-1 w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all ${task.completed ? 'bg-green-500 border-green-500' : 'border-slate-600 hover:border-cyan-500'}`}>
                              {task.completed && <Icon name="Check" size={14} />}
                            </button>
                            <div className="flex-1" onClick={() => setExpandedTask(exp ? null : task.id)}>
                              <h4 className={`font-bold text-sm ${task.completed ? 'line-through text-slate-500' : ''}`}>{task.title}</h4>
                              {task.deadline && <p className={`text-[10px] mt-1 flex items-center gap-1 font-mono ${st === 'overdue' ? 'text-red-400' : st === 'urgent' ? 'text-amber-400' : 'text-slate-500'}`}><Icon name="Clock" size={10} />{formatDate(task.deadline)}</p>}
                              {exp && task.details && <p className="mt-3 pt-3 border-t border-slate-700 text-xs text-slate-400">{task.details}</p>}
                            </div>
                            <button onMouseDown={() => startHoldDel(task.id)} onMouseUp={stopHoldDel} onMouseLeave={stopHoldDel} onTouchStart={() => startHoldDel(task.id)} onTouchEnd={stopHoldDel} className="relative w-8 h-8 rounded-lg bg-slate-800 flex items-center justify-center overflow-hidden">
                              {holding && <div className="absolute inset-0 bg-red-500/50" style={{ width: `${holdProgress}%` }} />}
                              <Icon name="Trash2" size={14} className="text-slate-500 relative z-10" />
                            </button>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                )}
                {showTaskForm && (
                  <div className="fixed inset-0 bg-black/90 flex items-center justify-center p-4 z-50">
                    <div className="w-full max-w-md glass rounded-2xl p-6 border border-cyan-500/30 animate-arise animate-pulse-border">
                      <div className="flex items-center justify-between mb-6">
                        <h3 className="text-xl font-orbitron font-black text-cyan-400">NOVA MISSÃO</h3>
                        <button onClick={() => setShowTaskForm(false)} className="w-10 h-10 rounded-lg bg-slate-800 flex items-center justify-center hover:bg-slate-700">
                          <Icon name="X" size={20} className="text-slate-400" />
                        </button>
                      </div>
                      <div className="space-y-4">
                        <input type="text" value={taskForm.title} onChange={e => setTaskForm({ ...taskForm, title: e.target.value })} placeholder="Título *" className="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white focus:border-cyan-500 focus:outline-none" />
                        <input type="date" value={taskForm.deadline} onChange={e => setTaskForm({ ...taskForm, deadline: e.target.value })} className="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white focus:border-cyan-500 focus:outline-none font-mono" />
                        <textarea value={taskForm.details} onChange={e => setTaskForm({ ...taskForm, details: e.target.value })} placeholder="Detalhes" rows={2} className="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white resize-none focus:border-cyan-500 focus:outline-none" />
                        <button onClick={addTask} disabled={!taskForm.title.trim()} className="w-full py-4 rounded-xl font-orbitron font-bold disabled:opacity-50 bg-gradient-to-r from-cyan-600 to-blue-600">CRIAR</button>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            )}

            {/* PERFIL */}
            {tab === 'perfil' && (
              <div className="p-4 pb-24 space-y-4 tab-enter">
                <div className="glass rounded-2xl p-6 border border-slate-700">
                  <div className="flex items-center gap-4 mb-6">
                    <div className="w-20 h-20 rounded-xl flex items-center justify-center text-4xl font-orbitron font-black animate-float" style={{ backgroundColor: rank.color, boxShadow: `0 0 30px ${rank.color}` }}>
                      {rank.name}
                    </div>
                    <div>
                      <h2 className="text-2xl font-orbitron font-black" style={{ color: rank.color }}>RANK {rank.name}</h2>
                      <p className="text-slate-500">{rank.title}</p>
                      <p className="font-mono text-cyan-400">LV {data.level} • {data.xp} XP</p>
                    </div>
                  </div>
                  <div className="grid grid-cols-2 gap-3">
                    <div className="bg-slate-800/50 rounded-xl p-4 border border-slate-700">
                      <p className="text-sm text-slate-500">Tópicos</p>
                      <p className="text-3xl font-mono font-black text-cyan-400">{data.items.length}</p>
                    </div>
                    <div className="bg-slate-800/50 rounded-xl p-4 border border-slate-700">
                      <p className="text-sm text-slate-500">Revisões</p>
                      <p className="text-3xl font-mono font-black text-amber-400">{data.sessions.filter(s => s.type === 'review').length}</p>
                    </div>
                  </div>
                </div>
                <div className="glass rounded-xl p-4 border border-slate-700">
                  <h3 className="text-sm font-orbitron text-slate-400 mb-3">EBBINGHAUS</h3>
                  <div className="space-y-2">
                    {INTERVALS.map((d, i) => (
                      <div key={i} className="flex justify-between p-2 bg-slate-800/50 rounded-lg">
                        <span className="text-slate-400 text-sm">{i + 1}ª Revisão</span>
                        <span className="font-mono text-cyan-400">{d}d</span>
                      </div>
                    ))}
                    <div className="flex justify-between p-2 bg-green-500/10 rounded-lg">
                      <span className="text-slate-400 text-sm">Manutenção</span>
                      <span className="font-mono text-green-400">45 em 45d</span>
                    </div>
                  </div>
                </div>
                <div className="glass rounded-xl p-4 border border-slate-700">
                  <h3 className="text-sm font-orbitron text-slate-400 mb-3">RANKS</h3>
                  <div className="space-y-2">
                    {ranks.map(r => {
                      const unlocked = data.xp >= r.minXp;
                      const current = rank.name === r.name;
                      return (
                        <div key={r.name} className={`flex items-center justify-between p-3 rounded-xl ${current ? 'ring-1' : unlocked ? 'bg-slate-800/50' : 'opacity-40'}`} style={{ ringColor: current ? r.color : undefined }}>
                          <div className="flex items-center gap-3">
                            <div className="w-10 h-10 rounded-lg flex items-center justify-center text-lg font-orbitron font-black" style={{ backgroundColor: unlocked ? r.color : '#374151' }}>{r.name}</div>
                            <div>
                              <p className="font-bold text-sm">{r.title}</p>
                              <p className="text-xs text-slate-500 font-mono">{r.minXp} XP</p>
                            </div>
                          </div>
                          {unlocked && <span className="text-green-500">✓</span>}
                        </div>
                      );
                    })}
                  </div>
                </div>
                <button onClick={() => { if (window.confirm('Resetar tudo?')) { setData({ sessions: [], items: [], xp: 0, hp: 100, level: 1, pushUpDebt: 0, lastStudy: null }); setExercise({ history: [], streak: 0, best: 0, total: 0 }); setTasks([]); setEscalas({}); }}} className="w-full py-4 rounded-xl font-orbitron font-bold bg-red-500/20 text-red-400 border border-red-500/30">RESETAR DADOS</button>
              </div>
            )}
          </div>

          {/* NAV */}
          <nav className="fixed bottom-0 left-0 right-0 glass border-t border-slate-800 safe-area-pb">
            <div className="max-w-md mx-auto flex justify-around py-2">
              {[
                { id: 'home', icon: 'Home', label: 'Missão' },
                { id: 'materias', icon: 'BookOpen', label: 'Matérias' },
                { id: 'escalas', icon: 'CalendarDays', label: 'Escalas' },
                { id: 'treino', icon: 'Dumbbell', label: 'Treino' },
                { id: 'missoes', icon: 'ListTodo', label: 'Tarefas' },
                { id: 'perfil', icon: 'User', label: 'Perfil' },
              ].map(({ id, icon, label }) => (
                <button key={id} onClick={() => setTab(id)} className={`flex flex-col items-center gap-1 py-2 px-2 rounded-xl transition-all ${tab === id ? 'text-cyan-400' : 'text-slate-500'}`}>
                  <Icon name={icon} size={20} />
                  <span className="text-[9px] font-orbitron">{label}</span>
                </button>
              ))}
            </div>
          </nav>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
