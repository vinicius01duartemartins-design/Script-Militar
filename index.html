<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HUNTER SYSTEM</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
  <style>
    body{font-family:system-ui;background:#0a0a0f}
    .font-orbitron{font-family:'Orbitron'}
    .glass{background:rgba(15,15,20,.95);backdrop-filter:blur(10px)}
    .hp-bar{background:linear-gradient(90deg,#dc2626,#ef4444);box-shadow:0 0 10px rgba(239,68,68,.5)}
    .xp-bar{background:linear-gradient(90deg,#7c3aed,#a78bfa);box-shadow:0 0 10px rgba(124,58,237,.5)}
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.95);display:flex;align-items:center;justify-content:center;padding:1rem;z-index:9999}
    .duty-day{animation:pulse-duty 2s ease-in-out infinite}
    @keyframes pulse-duty{0%,100%{box-shadow:0 0 5px currentColor}50%{box-shadow:0 0 15px currentColor,0 0 25px currentColor}}
  </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect,useRef}=React;
const Icon=({name,size=24})=>{const ref=useRef();useEffect(()=>{if(ref.current&&lucide.icons[name]){ref.current.innerHTML='';const i=lucide.createElement(lucide.icons[name]);i.setAttribute('width',size);i.setAttribute('height',size);ref.current.appendChild(i);}},[name,size]);return <span ref={ref} className="inline-flex items-center justify-center"/>;};

function App(){
  const [tab,setTab]=useState('home');
  const [modal,setModal]=useState(null);
  const [selSubj,setSelSubj]=useState(null);
  const [newSubj,setNewSubj]=useState('');
  const [selRev,setSelRev]=useState(null);
  const [month,setMonth]=useState(new Date());
  const [form,setForm]=useState({topic:'',mins:'',conf:3});
  const [taskForm,setTaskForm]=useState({title:'',desc:'',deadline:'',priority:'media'});
  const [expandedTask,setExpandedTask]=useState(null);
  
  // Escala form states
  const [escForm,setEscForm]=useState({
    date:'',
    tipo:'guarda', // guarda ou limpeza
    turma:'branca',
    posto:'',
    quarto:1,
    obs:''
  });
  const [selectedEscala,setSelectedEscala]=useState(null);
  const [escalaTab,setEscalaTab]=useState('calendario');

  const INT=[1,7,15,30,45];
  const SUBJ=['Comunica√ß√£o e Express√£o','Did√°tica','L√≥gica','Metodologia Cient√≠fica','Psicologia','Chefia e Lideran√ßa','Escritura√ß√£o Profissional','TIC','Gest√£o Contempor√¢nea','Gest√£o de Pessoas','Direito Administrativo','Direito Adm. Disciplinar Militar','Direito Penal','Direito Penal Militar','Doutrina de Pol√≠cia Ostensiva'];
  const RANKS=[{n:'E',min:0,max:299,c:'#6B7280',t:'Iniciante'},{n:'D',min:300,max:799,c:'#10B981',t:'Promissor'},{n:'C',min:800,max:1799,c:'#3B82F6',t:'Competente'},{n:'B',min:1800,max:3499,c:'#8B5CF6',t:'Elite'},{n:'A',min:3500,max:5999,c:'#EF4444',t:'Nacional'},{n:'S',min:6000,max:99999,c:'#F59E0B',t:'Shadow Monarch'}];
  const PRIORITIES={alta:{label:'Alta',color:'bg-red-500',border:'border-red-500',icon:'AlertTriangle'},media:{label:'M√©dia',color:'bg-amber-500',border:'border-amber-500',icon:'Minus'},baixa:{label:'Baixa',color:'bg-blue-500',border:'border-blue-500',icon:'ChevronDown'}};

  // Turmas
  const TURMAS=[
    {id:'branca',nome:'Branca',cor:'bg-white text-gray-900 border-white'},
    {id:'preta',nome:'Preta',cor:'bg-gray-900 text-white border-gray-500'},
    {id:'vermelha',nome:'Vermelha',cor:'bg-red-600 text-white border-red-400'},
    {id:'roxa',nome:'Roxa',cor:'bg-purple-600 text-white border-purple-400'}
  ];

  // Postos de Guarda - Atual
  const POSTOS_ATUAL=[
    {id:'sentinela_rancho',nome:'Sentinela Rancho',icon:'UtensilsCrossed'},
    {id:'sentinela_piscina',nome:'Sentinela Piscina',icon:'Waves'},
    {id:'plantao',nome:'Plant√£o',icon:'Phone'},
    {id:'permanencia',nome:'Perman√™ncia',icon:'Clock'}
  ];

  // Postos de Guarda - Pr√≥ximo m√™s
  const POSTOS_PROXIMO=[
    {id:'portao_1',nome:'Port√£o 1',icon:'DoorOpen'},
    {id:'portao_2',nome:'Port√£o 2',icon:'DoorClosed'},
    {id:'motorizada_enc',nome:'Motorizada (Encarregado)',icon:'Car'},
    {id:'motorizada_mot',nome:'Motorizada (Motorista)',icon:'Truck'},
    {id:'adjunto_dia',nome:'Adjunto de Dia',icon:'UserCheck'},
    {id:'aux_cmt_guarda',nome:'Aux Cmt da Guarda',icon:'Shield'}
  ];

  // Limpezas (Fiscal)
  const LIMPEZAS=[
    {id:'banheiro',nome:'Banheiro',icon:'Bath'},
    {id:'daxv',nome:'DAXV',icon:'Sparkles'},
    {id:'crossfit',nome:'Crossfit',icon:'Dumbbell'},
    {id:'musculacao',nome:'Muscula√ß√£o',icon:'Trophy'},
    {id:'lavanderia',nome:'Lavanderia',icon:'Shirt'}
  ];

  // Quartos de hora (2h cada, ciclam: 1¬∞‚Üí2¬∞‚Üí3¬∞‚Üí1¬∞‚Üí2¬∞‚Üí3¬∞...)
  const QUARTOS=[
    {id:1,nome:'1¬∫ Quarto',horarios:'07-09 | 13-15 | 19-21 | 01-03'},
    {id:2,nome:'2¬∫ Quarto',horarios:'09-11 | 15-17 | 21-23 | 03-05'},
    {id:3,nome:'3¬∫ Quarto',horarios:'11-13 | 17-19 | 23-01 | 05-07'}
  ];

  const [data,setData]=useState({items:[],xp:0,hp:100,lv:1,debt:0});
  const [ex,setEx]=useState({hist:[],streak:0,best:0});
  const [tasks,setTasks]=useState([]);
  const [escalas,setEscalas]=useState([]);
  const [config,setConfig]=useState({usarPostosNovos:false});

  useEffect(()=>{const s=localStorage.getItem('hv5');if(s){const p=JSON.parse(s);if(p.data)setData(p.data);if(p.ex)setEx(p.ex);if(p.tasks)setTasks(p.tasks);if(p.escalas)setEscalas(p.escalas);if(p.config)setConfig(p.config);}},[]);
  useEffect(()=>{localStorage.setItem('hv5',JSON.stringify({data,ex,tasks,escalas,config}));},[data,ex,tasks,escalas,config]);

  // Auto-delete completed tasks after 10 minutes & check overdue tasks
  useEffect(()=>{
    const interval=setInterval(()=>{
      const now=Date.now();
      setTasks(prev=>{
        let newTasks=[...prev];
        let xpLoss=0;
        newTasks=newTasks.filter(t=>{
          if(t.done&&t.completedAt&&(now-t.completedAt)>600000)return false;
          return true;
        });
        newTasks=newTasks.map(t=>{
          if(!t.done&&t.deadline&&!t.penalized){
            const deadline=new Date(t.deadline+'T23:59:59');
            if(now>deadline.getTime()){
              xpLoss+=t.priority==='alta'?100:t.priority==='media'?50:25;
              return{...t,penalized:true};
            }
          }
          return t;
        });
        if(xpLoss>0){
          setData(d=>({...d,xp:Math.max(0,d.xp-xpLoss)}));
          alert(`PRAZO PERDIDO! -${xpLoss} XP`);
        }
        return newTasks;
      });
    },10000);
    return()=>clearInterval(interval);
  },[]);

  const today=()=>new Date().toISOString().split('T')[0];
  const addD=(d,n)=>{const dt=new Date(d);dt.setDate(dt.getDate()+n);return dt.toISOString().split('T')[0];};
  const fmtD=(d)=>new Date(d+'T00:00:00').toLocaleDateString('pt-BR',{day:'2-digit',month:'short'});
  const fmtDFull=(d)=>new Date(d+'T00:00:00').toLocaleDateString('pt-BR',{weekday:'short',day:'2-digit',month:'short'});
  const daysTo=(d)=>Math.ceil((new Date(d+'T00:00:00')-new Date(today()+'T00:00:00'))/86400000);
  const hasEscala=(d)=>escalas.some(e=>e.date===d);
  const getEscalaByDate=(d)=>escalas.find(e=>e.date===d);
  const heal=(a)=>setData(p=>({...p,hp:Math.min(100,p.hp+a)}));
  const dmg=(a)=>setData(p=>{const h=Math.max(0,p.hp-a);if(h===0&&p.lv>1){alert('LEVEL DOWN!');return{...p,hp:100,lv:p.lv-1,xp:Math.max(0,p.xp-300)};}return{...p,hp:h};});

  const rank=RANKS.find(r=>data.xp>=r.min&&data.xp<=r.max)||RANKS[0];
  const nextR=RANKS[RANKS.findIndex(r=>r.n===rank.n)+1];
  const prog=nextR?((data.xp-rank.min)/(rank.max-rank.min+1))*100:100;
  const pend=data.items.filter(i=>i.next<=today()).sort((a,b)=>new Date(a.next)-new Date(b.next));
  const upcoming=data.items.filter(i=>i.next>today()).sort((a,b)=>new Date(a.next)-new Date(b.next));

  const addStudy=()=>{if(!form.topic||!form.mins||!newSubj)return;const t=today();setData(p=>({...p,items:[{id:Date.now(),subj:newSubj,topic:form.topic,date:t,stage:0,next:addD(t,INT[0]),revs:[]},...p.items],xp:p.xp+50}));heal(10);setForm({topic:'',mins:'',conf:3});setNewSubj('');setModal(null);};
  const doReview=()=>{if(!form.mins||!selRev)return;const t=today();const ns=selRev.stage+1;const ni=ns<INT.length?INT[ns]:45;setData(p=>({...p,items:p.items.map(i=>i.id===selRev.id?{...i,stage:ns,next:addD(t,ni),revs:[...i.revs,{d:t,c:form.conf}]}:i),xp:p.xp+40}));heal(5);setForm({topic:'',mins:'',conf:3});setSelRev(null);setModal(null);};
  const skipRev=()=>{dmg(5);setData(p=>({...p,xp:Math.max(0,p.xp-25),debt:p.debt+20}));setModal('punish');};
  const doPush=()=>{setData(p=>({...p,debt:0,xp:p.xp+10}));heal(5);setModal(null);};

  const togEx=(d)=>{if(hasEscala(d))return;let h=[...ex.hist];const i=h.findIndex(x=>x.d===d);let xc=0;if(i>=0){h[i]={...h[i],ok:!h[i].ok};xc=h[i].ok?40:-40;if(h[i].ok)heal(10);}else{h=[{d,ok:true},...h];xc=40;heal(10);}let s=0;for(let j=0;j<100;j++){const dd=addD(today(),-j);if(hasEscala(dd))continue;const e=h.find(x=>x.d===dd);if(e?.ok)s++;else break;}setEx({hist:h,streak:s,best:Math.max(ex.best,s)});setData(p=>({...p,xp:Math.max(0,p.xp+xc)}));};
  const last30=()=>{const d=[];const t=new Date();for(let i=29;i>=0;i--){const x=new Date(t);x.setDate(x.getDate()-i);const ds=x.toISOString().split('T')[0];d.push({d:ds,ok:ex.hist.find(h=>h.d===ds)?.ok||false,duty:hasEscala(ds),day:x.getDate()});}return d;};

  const addTask=()=>{
    if(!taskForm.title)return;
    setTasks(p=>[{id:Date.now(),title:taskForm.title,desc:taskForm.desc,deadline:taskForm.deadline,priority:taskForm.priority,done:false,penalized:false,createdAt:Date.now()},...p]);
    setTaskForm({title:'',desc:'',deadline:'',priority:'media'});
    setModal(null);
  };
  
  const togTask=(id)=>{
    setTasks(p=>p.map(t=>{
      if(t.id===id){
        if(!t.done){
          const xpGain=t.priority==='alta'?40:t.priority==='media'?25:15;
          setData(d=>({...d,xp:d.xp+xpGain}));
          heal(5);
          return{...t,done:true,completedAt:Date.now()};
        }else{
          const xpGain=t.priority==='alta'?40:t.priority==='media'?25:15;
          setData(d=>({...d,xp:Math.max(0,d.xp-xpGain)}));
          return{...t,done:false,completedAt:null};
        }
      }
      return t;
    }));
  };

  const getDeadlineColor=(deadline,done)=>{
    if(done)return'text-gray-500';
    if(!deadline)return'text-gray-400';
    const days=daysTo(deadline);
    if(days<0)return'text-red-500 font-bold';
    if(days<=1)return'text-red-400';
    if(days<=3)return'text-amber-400';
    return'text-green-400';
  };

  const getDeadlineText=(deadline,done)=>{
    if(!deadline)return'';
    const days=daysTo(deadline);
    if(days<0)return`ATRASADA ${Math.abs(days)}d`;
    if(days===0)return'HOJE';
    if(days===1)return'AMANH√É';
    return`${days} dias`;
  };

  const monthDays=()=>{const y=month.getFullYear(),m=month.getMonth();const f=new Date(y,m,1),l=new Date(y,m+1,0);const d=[];for(let i=0;i<f.getDay();i++)d.push(null);for(let i=1;i<=l.getDate();i++)d.push({day:i,date:new Date(y,m,i).toISOString().split('T')[0]});return d;};
  
  // Escala functions
  const addEscala=()=>{
    if(!escForm.date||!escForm.posto)return;
    const newEsc={
      id:Date.now(),
      date:escForm.date,
      tipo:escForm.tipo,
      turma:escForm.turma,
      posto:escForm.posto,
      quarto:escForm.quarto,
      obs:escForm.obs
    };
    setEscalas(p=>[...p,newEsc]);
    setEscForm({date:'',tipo:'guarda',turma:'branca',posto:'',quarto:1,obs:''});
    setModal(null);
  };

  const deleteEscala=(id)=>{
    setEscalas(p=>p.filter(e=>e.id!==id));
    setSelectedEscala(null);
  };

  const getPostoNome=(postoId)=>{
    const allPostos=[...POSTOS_ATUAL,...POSTOS_PROXIMO,...LIMPEZAS];
    return allPostos.find(p=>p.id===postoId)?.nome||postoId;
  };

  const getPostoIcon=(postoId)=>{
    const allPostos=[...POSTOS_ATUAL,...POSTOS_PROXIMO,...LIMPEZAS];
    return allPostos.find(p=>p.id===postoId)?.icon||'Circle';
  };

  const getTurmaCor=(turmaId)=>{
    return TURMAS.find(t=>t.id===turmaId)?.cor||'bg-gray-700 text-white';
  };

  const getTurmaNome=(turmaId)=>{
    return TURMAS.find(t=>t.id===turmaId)?.nome||turmaId;
  };

  const getQuartoInfo=(quartoId)=>{
    return QUARTOS.find(q=>q.id===quartoId)||{nome:'',horarios:''};
  };

  const currentPostos=config.usarPostosNovos?POSTOS_PROXIMO:POSTOS_ATUAL;

  const proximasEscalas=escalas
    .filter(e=>e.date>=today())
    .sort((a,b)=>new Date(a.date)-new Date(b.date))
    .slice(0,5);

  const escalasMes=escalas.filter(e=>{
    const dt=new Date(e.date+'T00:00:00');
    return dt.getMonth()===month.getMonth()&&dt.getFullYear()===month.getFullYear();
  });

  const stageName=(s)=>['1¬™ Rev','2¬™ Rev','3¬™ Rev','4¬™ Rev','5¬™ Rev'][s]||'Manut.';

  const sortedTasks=[...tasks].sort((a,b)=>{
    if(a.done!==b.done)return a.done?1:-1;
    const prioOrder={alta:0,media:1,baixa:2};
    if(prioOrder[a.priority]!==prioOrder[b.priority])return prioOrder[a.priority]-prioOrder[b.priority];
    if(a.deadline&&b.deadline)return new Date(a.deadline)-new Date(b.deadline);
    if(a.deadline)return -1;
    if(b.deadline)return 1;
    return 0;
  });

  return(
    <div className="min-h-screen bg-[#0a0a0f] text-white pb-20">
      {/* MODALS */}
      {modal==='study'&&(
        <div className="modal" onClick={()=>setModal(null)}>
          <div className="w-full max-w-md glass rounded-2xl p-6 border border-cyan-500/50 max-h-[90vh] overflow-auto" onClick={e=>e.stopPropagation()}>
            <div className="flex justify-between mb-4"><h2 className="text-xl font-orbitron text-cyan-400">NOVO ESTUDO</h2><button onClick={()=>setModal(null)} className="text-gray-400 text-xl">‚úï</button></div>
            <div className="space-y-4">
              <select value={newSubj} onChange={e=>setNewSubj(e.target.value)} className="w-full bg-gray-800 border border-gray-700 rounded-lg p-3"><option value="">Mat√©ria...</option>{SUBJ.map(s=><option key={s} value={s}>{s}</option>)}</select>
              {newSubj&&<>
                <div className="bg-cyan-500/10 border border-cyan-500/30 rounded-lg p-3"><p className="text-cyan-400 font-bold">{newSubj}</p><p className="text-xs text-gray-500">1d‚Üí7d‚Üí15d‚Üí30d‚Üí45d</p></div>
                <input value={form.topic} onChange={e=>setForm({...form,topic:e.target.value})} placeholder="T√≥pico *" className="w-full bg-gray-800 border border-gray-700 rounded-lg p-3"/>
                <input type="number" value={form.mins} onChange={e=>setForm({...form,mins:e.target.value})} placeholder="Minutos *" className="w-full bg-gray-800 border border-gray-700 rounded-lg p-3"/>
                <div className="flex gap-2">{[1,2,3,4,5].map(n=><button key={n} onClick={()=>setForm({...form,conf:n})} className={`flex-1 py-2 rounded-lg font-bold ${form.conf===n?'bg-cyan-500':'bg-gray-800 text-gray-400'}`}>{n}</button>)}</div>
                <button onClick={addStudy} disabled={!form.topic||!form.mins} className="w-full py-4 rounded-xl font-orbitron bg-gradient-to-r from-cyan-600 to-blue-600 disabled:opacity-50">REGISTRAR +50 XP</button>
              </>}
            </div>
          </div>
        </div>
      )}

      {modal==='review'&&selRev&&(
        <div className="modal" onClick={()=>setModal(null)}>
          <div className="w-full max-w-md glass rounded-2xl p-6 border border-amber-500/50" onClick={e=>e.stopPropagation()}>
            <div className="flex justify-between mb-4"><h2 className="text-xl font-orbitron text-amber-400">REVIS√ÉO</h2><button onClick={()=>setModal(null)} className="text-gray-400 text-xl">‚úï</button></div>
            <div className="bg-amber-500/10 border border-amber-500/30 rounded-lg p-4 mb-4">
              <p className="text-xs text-amber-500">{selRev.subj}</p>
              <p className="font-bold text-amber-400">{selRev.topic}</p>
              <span className="text-xs bg-amber-500/20 text-amber-400 px-2 py-1 rounded mt-2 inline-block">{stageName(selRev.stage)}</span>
            </div>
            <div className="space-y-4">
              <input type="number" value={form.mins} onChange={e=>setForm({...form,mins:e.target.value})} placeholder="Minutos *" className="w-full bg-gray-800 border border-gray-700 rounded-lg p-3"/>
              <div className="flex gap-2">{[1,2,3,4,5].map(n=><button key={n} onClick={()=>setForm({...form,conf:n})} className={`flex-1 py-2 rounded-lg font-bold ${form.conf===n?'bg-amber-500 text-black':'bg-gray-800 text-gray-400'}`}>{n}</button>)}</div>
              <button onClick={doReview} disabled={!form.mins} className="w-full py-4 rounded-xl font-orbitron bg-gradient-to-r from-amber-500 to-orange-500 text-black disabled:opacity-50">COMPLETAR +40 XP</button>
            </div>
          </div>
        </div>
      )}

      {modal==='task'&&(
        <div className="modal" onClick={()=>setModal(null)}>
          <div className="w-full max-w-md glass rounded-2xl p-6 border border-cyan-500/50 max-h-[90vh] overflow-auto" onClick={e=>e.stopPropagation()}>
            <div className="flex justify-between mb-4"><h2 className="text-xl font-orbitron text-cyan-400">NOVA MISS√ÉO</h2><button onClick={()=>setModal(null)} className="text-gray-400 text-xl">‚úï</button></div>
            <div className="space-y-4">
              <input value={taskForm.title} onChange={e=>setTaskForm({...taskForm,title:e.target.value})} placeholder="T√≠tulo *" className="w-full bg-gray-800 border border-gray-700 rounded-lg p-3"/>
              <textarea value={taskForm.desc} onChange={e=>setTaskForm({...taskForm,desc:e.target.value})} placeholder="Descri√ß√£o (opcional)" rows={3} className="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 resize-none"/>
              <div>
                <label className="text-xs text-gray-400 block mb-2">PRAZO</label>
                <input type="date" value={taskForm.deadline} onChange={e=>setTaskForm({...taskForm,deadline:e.target.value})} className="w-full bg-gray-800 border border-gray-700 rounded-lg p-3"/>
              </div>
              <div>
                <label className="text-xs text-gray-400 block mb-2">PRIORIDADE</label>
                <div className="grid grid-cols-3 gap-2">
                  {Object.entries(PRIORITIES).map(([k,v])=>(
                    <button key={k} onClick={()=>setTaskForm({...taskForm,priority:k})} className={`p-3 rounded-lg font-bold text-sm flex items-center justify-center gap-1 ${taskForm.priority===k?`${v.color} text-white`:'bg-gray-800 text-gray-400'}`}>
                      <Icon name={v.icon} size={14}/>{v.label}
                    </button>
                  ))}
                </div>
              </div>
              <div className="bg-gray-800/50 rounded-lg p-3 text-xs text-gray-400">
                <p>üí∞ XP ao completar: Alta +40 | M√©dia +25 | Baixa +15</p>
                <p className="text-red-400 mt-1">‚ö† Perda por atraso: Alta -100 | M√©dia -50 | Baixa -25</p>
              </div>
              <button onClick={addTask} disabled={!taskForm.title} className="w-full py-4 rounded-xl font-orbitron bg-gradient-to-r from-cyan-600 to-blue-600 disabled:opacity-50">CRIAR MISS√ÉO</button>
            </div>
          </div>
        </div>
      )}

      {/* NOVA ESCALA MODAL */}
      {modal==='escala'&&(
        <div className="modal" onClick={()=>setModal(null)}>
          <div className="w-full max-w-md glass rounded-2xl p-6 border border-cyan-500/50 max-h-[90vh] overflow-auto" onClick={e=>e.stopPropagation()}>
            <div className="flex justify-between mb-4">
              <h2 className="text-xl font-orbitron text-cyan-400">NOVA ESCALA</h2>
              <button onClick={()=>setModal(null)} className="text-gray-400 text-xl">‚úï</button>
            </div>
            <div className="space-y-4">
              {/* Data */}
              <div>
                <label className="text-xs text-gray-400 block mb-2">DATA *</label>
                <input type="date" value={escForm.date} onChange={e=>setEscForm({...escForm,date:e.target.value})} className="w-full bg-gray-800 border border-gray-700 rounded-lg p-3"/>
              </div>

              {/* Tipo */}
              <div>
                <label className="text-xs text-gray-400 block mb-2">TIPO DE SERVI√áO</label>
                <div className="grid grid-cols-2 gap-2">
                  <button onClick={()=>setEscForm({...escForm,tipo:'guarda',posto:''})} className={`p-3 rounded-lg font-bold text-sm flex items-center justify-center gap-2 ${escForm.tipo==='guarda'?'bg-amber-500 text-black':'bg-gray-800 text-gray-400'}`}>
                    <Icon name="Shield" size={16}/>Guarda
                  </button>
                  <button onClick={()=>setEscForm({...escForm,tipo:'limpeza',posto:''})} className={`p-3 rounded-lg font-bold text-sm flex items-center justify-center gap-2 ${escForm.tipo==='limpeza'?'bg-green-500 text-black':'bg-gray-800 text-gray-400'}`}>
                    <Icon name="Sparkles" size={16}/>Limpeza (Fiscal)
                  </button>
                </div>
              </div>

              {/* Turma */}
              <div>
                <label className="text-xs text-gray-400 block mb-2">TURMA</label>
                <div className="grid grid-cols-4 gap-2">
                  {TURMAS.map(t=>(
                    <button key={t.id} onClick={()=>setEscForm({...escForm,turma:t.id})} className={`p-2 rounded-lg font-bold text-xs border-2 ${t.cor} ${escForm.turma===t.id?'ring-2 ring-cyan-500':'opacity-60'}`}>
                      {t.nome}
                    </button>
                  ))}
                </div>
              </div>

              {/* Posto (Guarda) */}
              {escForm.tipo==='guarda'&&(
                <div>
                  <label className="text-xs text-gray-400 block mb-2">POSTO *</label>
                  <div className="grid grid-cols-2 gap-2">
                    {currentPostos.map(p=>(
                      <button key={p.id} onClick={()=>setEscForm({...escForm,posto:p.id})} className={`p-3 rounded-lg text-sm flex items-center gap-2 ${escForm.posto===p.id?'bg-amber-500 text-black font-bold':'bg-gray-800 text-gray-300'}`}>
                        <Icon name={p.icon} size={16}/>{p.nome}
                      </button>
                    ))}
                  </div>
                </div>
              )}

              {/* Limpeza */}
              {escForm.tipo==='limpeza'&&(
                <div>
                  <label className="text-xs text-gray-400 block mb-2">LOCAL *</label>
                  <div className="grid grid-cols-2 gap-2">
                    {LIMPEZAS.map(l=>(
                      <button key={l.id} onClick={()=>setEscForm({...escForm,posto:l.id})} className={`p-3 rounded-lg text-sm flex items-center gap-2 ${escForm.posto===l.id?'bg-green-500 text-black font-bold':'bg-gray-800 text-gray-300'}`}>
                        <Icon name={l.icon} size={16}/>{l.nome}
                      </button>
                    ))}
                  </div>
                </div>
              )}

              {/* Quarto de Hora (s√≥ para guarda) */}
              {escForm.tipo==='guarda'&&(
                <div>
                  <label className="text-xs text-gray-400 block mb-2">QUARTO DE HORA</label>
                  <select value={escForm.quarto} onChange={e=>setEscForm({...escForm,quarto:parseInt(e.target.value)})} className="w-full bg-gray-800 border border-gray-700 rounded-lg p-3">
                    {QUARTOS.map(q=>(
                      <option key={q.id} value={q.id}>{q.nome}</option>
                    ))}
                  </select>
                  <div className="mt-2 bg-gray-800/50 rounded-lg p-3">
                    <p className="text-xs text-gray-400 mb-1">Hor√°rios do {getQuartoInfo(escForm.quarto).nome}:</p>
                    <p className="text-sm text-cyan-400 font-mono">{getQuartoInfo(escForm.quarto).horarios}</p>
                  </div>
                  <p className="text-xs text-gray-500 mt-2">‚è∞ Ciclo: 1¬∞‚Üí2¬∞‚Üí3¬∞‚Üí1¬∞‚Üí2¬∞‚Üí3¬∞... (24h)</p>
                </div>
              )}

              {/* Observa√ß√µes */}
              <div>
                <label className="text-xs text-gray-400 block mb-2">OBSERVA√á√ïES</label>
                <textarea value={escForm.obs} onChange={e=>setEscForm({...escForm,obs:e.target.value})} placeholder="Anota√ß√µes adicionais..." rows={2} className="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 resize-none"/>
              </div>

              <button onClick={addEscala} disabled={!escForm.date||!escForm.posto} className="w-full py-4 rounded-xl font-orbitron bg-gradient-to-r from-cyan-600 to-blue-600 disabled:opacity-50">
                REGISTRAR ESCALA
              </button>
            </div>
          </div>
        </div>
      )}

      {/* DETALHES ESCALA MODAL */}
      {modal==='escala-detail'&&selectedEscala&&(
        <div className="modal" onClick={()=>{setModal(null);setSelectedEscala(null);}}>
          <div className="w-full max-w-md glass rounded-2xl p-6 border border-cyan-500/50" onClick={e=>e.stopPropagation()}>
            <div className="flex justify-between mb-4">
              <h2 className="text-xl font-orbitron text-cyan-400">DETALHES</h2>
              <button onClick={()=>{setModal(null);setSelectedEscala(null);}} className="text-gray-400 text-xl">‚úï</button>
            </div>
            
            <div className="space-y-4">
              <div className="text-center">
                <p className="text-2xl font-bold">{fmtDFull(selectedEscala.date)}</p>
                <span className={`inline-block mt-2 px-3 py-1 rounded-full text-sm font-bold ${getTurmaCor(selectedEscala.turma)}`}>
                  Turma {getTurmaNome(selectedEscala.turma)}
                </span>
              </div>

              <div className={`rounded-xl p-4 border-2 ${selectedEscala.tipo==='guarda'?'border-amber-500 bg-amber-500/10':'border-green-500 bg-green-500/10'}`}>
                <div className="flex items-center gap-3">
                  <div className={`w-12 h-12 rounded-xl flex items-center justify-center ${selectedEscala.tipo==='guarda'?'bg-amber-500':'bg-green-500'}`}>
                    <Icon name={getPostoIcon(selectedEscala.posto)} size={24} className="text-black"/>
                  </div>
                  <div>
                    <p className="text-xs text-gray-400">{selectedEscala.tipo==='guarda'?'POSTO':'FISCAL DE LIMPEZA'}</p>
                    <p className="text-lg font-bold">{getPostoNome(selectedEscala.posto)}</p>
                  </div>
                </div>
              </div>

              {selectedEscala.tipo==='guarda'&&(
                <div className="bg-gray-800/50 rounded-xl p-4">
                  <p className="text-xs text-gray-400 mb-2">QUARTO DE HORA</p>
                  <p className="font-bold text-lg">{getQuartoInfo(selectedEscala.quarto).nome}</p>
                  <p className="text-cyan-400 font-mono text-sm mt-1">{getQuartoInfo(selectedEscala.quarto).horarios}</p>
                </div>
              )}

              {selectedEscala.obs&&(
                <div className="bg-gray-800/50 rounded-xl p-4">
                  <p className="text-xs text-gray-400 mb-2">OBSERVA√á√ïES</p>
                  <p className="text-sm">{selectedEscala.obs}</p>
                </div>
              )}

              <button onClick={()=>deleteEscala(selectedEscala.id)} className="w-full py-3 rounded-xl bg-red-500/20 text-red-400 border border-red-500/30 font-bold flex items-center justify-center gap-2">
                <Icon name="Trash2" size={16}/>EXCLUIR ESCALA
              </button>
            </div>
          </div>
        </div>
      )}

      {modal==='punish'&&data.debt>0&&(
        <div className="modal">
          <div className="w-full max-w-md glass rounded-2xl p-6 border-2 border-red-500/50 text-center">
            <h2 className="text-2xl font-orbitron text-red-500 mb-4">PUNI√á√ÉO</h2>
            <div className="bg-red-500/10 rounded-xl p-6 mb-6 border border-red-500/30">
              <p className="text-5xl font-bold text-red-500">{data.debt}</p>
              <p className="text-xl text-red-400 mt-2">FLEX√ïES</p>
            </div>
            <button onClick={doPush} className="w-full py-4 rounded-xl font-orbitron bg-gradient-to-r from-green-600 to-emerald-600">CONCLU√çDO +10 XP</button>
            <button onClick={()=>setModal(null)} className="w-full py-3 text-gray-500 text-sm mt-2">Depois</button>
          </div>
        </div>
      )}

      {/* CONTENT */}
      <div className="max-w-md mx-auto p-4">
        {tab==='home'&&(
          <div className="space-y-4">
            <div className="glass rounded-2xl p-5 border border-cyan-500/30">
              <div className="flex justify-between mb-4">
                <div>
                  <div className="w-14 h-14 rounded-xl flex items-center justify-center text-2xl font-orbitron font-black mb-2" style={{backgroundColor:rank.c,boxShadow:`0 0 20px ${rank.c}`}}>{rank.n}</div>
                  <h2 className="text-lg font-orbitron font-bold" style={{color:rank.c}}>RANK {rank.n}</h2>
                  <p className="text-gray-500 text-xs">{rank.t}</p>
                  <p className="text-cyan-400 text-xs mt-1">LV {data.lv}</p>
                </div>
                <div className="text-right">
                  <p className="text-2xl font-bold text-purple-400">{data.xp}</p>
                  <p className="text-[10px] text-gray-500">XP</p>
                </div>
              </div>
              <div className="mb-3">
                <div className="flex justify-between text-[10px] text-gray-500 mb-1"><span>XP</span><span>{nextR?`${nextR.min-data.xp}‚Üí${nextR.n}`:'MAX'}</span></div>
                <div className="w-full bg-gray-800 rounded-full h-2.5"><div className="xp-bar h-full rounded-full transition-all" style={{width:`${prog}%`}}/></div>
              </div>
              <div>
                <div className="flex justify-between text-[10px] mb-1"><span className="text-red-400">HP</span><span className="text-red-400">{data.hp}/100</span></div>
                <div className="w-full bg-gray-800/50 rounded-full h-2.5 border border-red-500/30"><div className={`hp-bar h-full rounded-full transition-all ${data.hp<=20?'animate-pulse':''}`} style={{width:`${data.hp}%`}}/></div>
                {data.hp<=20&&<p className="text-red-500 text-[10px] mt-1 animate-pulse">‚ö† HP CR√çTICO</p>}
              </div>
              {data.debt>0&&<button onClick={()=>setModal('punish')} className="w-full mt-4 py-2 rounded-lg bg-red-500/20 border border-red-500/50 text-red-400 text-sm">D√çVIDA: {data.debt} FLEX√ïES</button>}
            </div>

            <button onClick={()=>setModal('study')} className="w-full py-4 rounded-xl font-orbitron font-bold bg-gradient-to-r from-cyan-600 to-blue-600 flex items-center justify-center gap-2">
              <Icon name="Plus" size={20}/> NOVO ESTUDO <span className="text-cyan-200 text-sm">+50 XP</span>
            </button>

            {pend.length>0&&(
              <div className="glass rounded-xl p-4 border border-amber-500/30">
                <div className="flex items-center gap-2 mb-4"><Icon name="Brain" size={20} className="text-amber-500"/><span className="font-orbitron text-amber-400">REVIS√ïES</span><span className="ml-auto bg-amber-500 text-black text-sm font-bold px-2 py-0.5 rounded-full">{pend.length}</span></div>
                <div className="space-y-3">
                  {pend.slice(0,3).map(item=>(
                    <div key={item.id} className={`glass rounded-lg p-3 border ${daysTo(item.next)<0?'border-red-500/50':'border-amber-500/30'}`}>
                      <p className="text-[10px] text-gray-500">{item.subj}</p>
                      <p className="font-bold text-sm">{item.topic}</p>
                      <div className="flex gap-2 mt-2">
                        <button onClick={()=>{setSelRev(item);setModal('review');}} className="flex-1 py-2 rounded-lg text-sm font-bold bg-amber-500 text-black">REVISAR</button>
                        <button onClick={skipRev} className="flex-1 py-2 rounded-lg text-sm font-bold bg-red-500/20 text-red-400 border border-red-500/30">PULAR</button>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {pend.length===0&&data.items.length>0&&(
              <div className="glass rounded-xl p-6 border border-green-500/30 text-center">
                <Icon name="CheckCircle2" size={32} className="mx-auto text-green-500 mb-2"/>
                <p className="font-orbitron text-green-400">SISTEMA LIMPO</p>
                <p className="text-xs text-gray-500 mt-1">Pr√≥xima: {upcoming[0]?fmtD(upcoming[0].next):'-'}</p>
              </div>
            )}

            <div className="grid grid-cols-3 gap-3">
              <div className="glass rounded-xl p-3 border border-gray-800"><Icon name="Award" size={16} className="text-cyan-400 mb-1"/><p className="text-[10px] text-gray-500">ESTUDOS</p><p className="text-xl font-bold text-cyan-400">{data.items.length}</p></div>
              <div className="glass rounded-xl p-3 border border-gray-800"><Icon name="RefreshCw" size={16} className="text-amber-400 mb-1"/><p className="text-[10px] text-gray-500">REVIS√ïES</p><p className="text-xl font-bold text-amber-400">{data.items.reduce((a,i)=>a+i.revs.length,0)}</p></div>
              <div className="glass rounded-xl p-3 border border-gray-800"><Icon name="Flame" size={16} className="text-orange-400 mb-1"/><p className="text-[10px] text-gray-500">STREAK</p><p className="text-xl font-bold text-orange-400">{ex.streak}</p></div>
            </div>
          </div>
        )}

        {tab==='materias'&&(
          <div className="space-y-3">
            <h1 className="text-xl font-orbitron font-bold mb-4">MAT√âRIAS</h1>
            {SUBJ.map(s=>{const its=data.items.filter(i=>i.subj===s);const exp=selSubj===s;return(
              <div key={s} className={`glass rounded-xl border overflow-hidden ${its.length?'border-gray-700':'border-gray-800 opacity-50'}`}>
                <button onClick={()=>its.length&&setSelSubj(exp?null:s)} className="w-full p-4 flex items-center justify-between text-left" disabled={!its.length}>
                  <div><p className="font-bold text-sm">{s}</p><p className="text-[10px] text-gray-500">{its.length?`${its.length} t√≥picos`:'N√£o iniciada'}</p></div>
                  {its.length>0&&<Icon name="ChevronDown" size={16} className={`text-gray-500 transition-transform ${exp?'rotate-180':''}`}/>}
                </button>
                {exp&&its.length>0&&(
                  <div className="border-t border-gray-800 p-3 space-y-2">
                    {its.map(it=>(
                      <div key={it.id} className="bg-gray-800/50 rounded-lg p-3">
                        <div className="flex justify-between"><div><p className="font-medium text-sm">{it.topic}</p><p className="text-[10px] text-gray-500">{fmtD(it.date)} ‚Ä¢ {it.revs.length} rev</p></div>
                        <span className={`text-[10px] px-2 py-0.5 rounded ${daysTo(it.next)<0?'bg-red-500/20 text-red-400':'bg-blue-500/20 text-blue-400'}`}>{daysTo(it.next)<0?'Atrasada':`${daysTo(it.next)}d`}</span></div>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            );})}
          </div>
        )}

        {tab==='escalas'&&(
          <div className="space-y-4">
            <div className="flex justify-between items-center">
              <h1 className="text-xl font-orbitron font-bold">ESCALAS</h1>
              <button onClick={()=>setModal('escala')} className="w-10 h-10 rounded-lg bg-cyan-600 flex items-center justify-center">
                <Icon name="Plus" size={20}/>
              </button>
            </div>

            {/* Sub-tabs */}
            <div className="flex gap-2">
              {[{id:'calendario',icon:'Calendar',label:'Calend√°rio'},{id:'lista',icon:'List',label:'Lista'},{id:'config',icon:'Settings',label:'Config'}].map(t=>(
                <button key={t.id} onClick={()=>setEscalaTab(t.id)} className={`flex-1 py-2 rounded-lg text-sm font-bold flex items-center justify-center gap-1 ${escalaTab===t.id?'bg-cyan-500 text-black':'bg-gray-800 text-gray-400'}`}>
                  <Icon name={t.icon} size={14}/>{t.label}
                </button>
              ))}
            </div>

            {escalaTab==='calendario'&&(
              <>
                {/* Calend√°rio */}
                <div className="glass rounded-xl p-4 border border-gray-700">
                  <div className="flex justify-between items-center mb-4">
                    <button onClick={()=>setMonth(new Date(month.getFullYear(),month.getMonth()-1))} className="p-2"><Icon name="ChevronLeft" size={18}/></button>
                    <span className="font-orbitron capitalize">{month.toLocaleDateString('pt-BR',{month:'long',year:'numeric'})}</span>
                    <button onClick={()=>setMonth(new Date(month.getFullYear(),month.getMonth()+1))} className="p-2"><Icon name="ChevronRight" size={18}/></button>
                  </div>
                  <div className="grid grid-cols-7 gap-1 mb-2">{['D','S','T','Q','Q','S','S'].map((d,i)=><div key={i} className="text-center text-[10px] text-gray-500 py-1">{d}</div>)}</div>
                  <div className="grid grid-cols-7 gap-1">
                    {monthDays().map((d,i)=>{
                      if(!d)return<div key={i} className="aspect-square"/>;
                      const esc=getEscalaByDate(d.date);
                      const isToday=d.date===today();
                      return(
                        <button 
                          key={d.date} 
                          onClick={()=>{
                            if(esc){setSelectedEscala(esc);setModal('escala-detail');}
                            else{setEscForm({...escForm,date:d.date});setModal('escala');}
                          }}
                          className={`aspect-square rounded-lg flex flex-col items-center justify-center text-xs font-bold border-2 transition-all ${
                            esc
                              ?`${getTurmaCor(esc.turma)} duty-day`
                              :'bg-gray-800/50 border-gray-700 text-gray-400 hover:border-gray-500'
                          } ${isToday?'ring-2 ring-cyan-500 ring-offset-1 ring-offset-[#0a0a0f]':''}`}
                        >
                          <span>{d.day}</span>
                          {esc&&<Icon name={esc.tipo==='guarda'?'Shield':'Sparkles'} size={10}/>}
                        </button>
                      );
                    })}
                  </div>
                </div>

                {/* Legenda */}
                <div className="glass rounded-xl p-4 border border-gray-700">
                  <p className="text-xs text-gray-500 mb-3">TURMAS</p>
                  <div className="grid grid-cols-4 gap-2">
                    {TURMAS.map(t=>(
                      <div key={t.id} className={`${t.cor} rounded-lg p-2 text-center text-xs font-bold border-2`}>
                        {t.nome}
                      </div>
                    ))}
                  </div>
                  <div className="flex gap-4 mt-3 text-xs text-gray-400">
                    <span className="flex items-center gap-1"><Icon name="Shield" size={12}/>Guarda</span>
                    <span className="flex items-center gap-1"><Icon name="Sparkles" size={12}/>Limpeza</span>
                  </div>
                </div>

                {/* Estat√≠sticas do m√™s */}
                <div className="glass rounded-xl p-4 border border-gray-700">
                  <p className="text-xs text-gray-500 mb-2">ESTE M√äS: {escalasMes.length} SERVI√áOS</p>
                  <div className="grid grid-cols-2 gap-2">
                    <div className="bg-amber-500/20 rounded-lg p-3 text-center">
                      <p className="text-2xl font-bold text-amber-400">{escalasMes.filter(e=>e.tipo==='guarda').length}</p>
                      <p className="text-[10px] text-gray-400">Guardas</p>
                    </div>
                    <div className="bg-green-500/20 rounded-lg p-3 text-center">
                      <p className="text-2xl font-bold text-green-400">{escalasMes.filter(e=>e.tipo==='limpeza').length}</p>
                      <p className="text-[10px] text-gray-400">Limpezas</p>
                    </div>
                  </div>
                </div>
              </>
            )}

            {escalaTab==='lista'&&(
              <>
                {/* Pr√≥ximas escalas */}
                <div className="glass rounded-xl p-4 border border-gray-700">
                  <p className="text-xs text-gray-500 mb-3">PR√ìXIMAS ESCALAS</p>
                  {proximasEscalas.length===0?(
                    <p className="text-center text-gray-500 py-4">Nenhuma escala agendada</p>
                  ):(
                    <div className="space-y-2">
                      {proximasEscalas.map(esc=>(
                        <button key={esc.id} onClick={()=>{setSelectedEscala(esc);setModal('escala-detail');}} className="w-full bg-gray-800/50 rounded-lg p-3 flex items-center gap-3 text-left">
                          <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${esc.tipo==='guarda'?'bg-amber-500':'bg-green-500'}`}>
                            <Icon name={getPostoIcon(esc.posto)} size={20} className="text-black"/>
                          </div>
                          <div className="flex-1">
                            <p className="font-bold text-sm">{getPostoNome(esc.posto)}</p>
                            <div className="flex items-center gap-2 mt-1">
                              <span className={`text-[10px] px-2 py-0.5 rounded ${getTurmaCor(esc.turma)}`}>{getTurmaNome(esc.turma)}</span>
                              {esc.tipo==='guarda'&&<span className="text-[10px] text-gray-500">{getQuartoInfo(esc.quarto).nome}</span>}
                            </div>
                          </div>
                          <div className="text-right">
                            <p className="text-sm font-bold">{fmtD(esc.date)}</p>
                            <p className={`text-[10px] ${daysTo(esc.date)<=1?'text-red-400':'text-gray-500'}`}>
                              {daysTo(esc.date)===0?'HOJE':daysTo(esc.date)===1?'AMANH√É':`${daysTo(esc.date)}d`}
                            </p>
                          </div>
                        </button>
                      ))}
                    </div>
                  )}
                </div>

                {/* Hist√≥rico */}
                <div className="glass rounded-xl p-4 border border-gray-700">
                  <p className="text-xs text-gray-500 mb-3">HIST√ìRICO ({escalas.filter(e=>e.date<today()).length})</p>
                  {escalas.filter(e=>e.date<today()).length===0?(
                    <p className="text-center text-gray-500 py-4">Nenhuma escala anterior</p>
                  ):(
                    <div className="space-y-2 max-h-60 overflow-auto">
                      {escalas.filter(e=>e.date<today()).sort((a,b)=>new Date(b.date)-new Date(a.date)).slice(0,10).map(esc=>(
                        <div key={esc.id} className="bg-gray-800/30 rounded-lg p-2 flex items-center gap-2 opacity-60">
                          <Icon name={getPostoIcon(esc.posto)} size={16} className="text-gray-500"/>
                          <span className="text-sm flex-1">{getPostoNome(esc.posto)}</span>
                          <span className="text-xs text-gray-500">{fmtD(esc.date)}</span>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              </>
            )}

            {escalaTab==='config'&&(
              <div className="space-y-4">
                {/* Toggle Postos */}
                <div className="glass rounded-xl p-4 border border-gray-700">
                  <div className="flex items-center justify-between mb-4">
                    <div>
                      <p className="font-bold">Postos de Guarda</p>
                      <p className="text-xs text-gray-500">Selecione os postos dispon√≠veis</p>
                    </div>
                  </div>
                  <div className="space-y-2">
                    <button onClick={()=>setConfig({...config,usarPostosNovos:false})} className={`w-full p-3 rounded-lg text-left flex items-center justify-between ${!config.usarPostosNovos?'bg-cyan-500/20 border border-cyan-500':'bg-gray-800'}`}>
                      <div>
                        <p className="font-bold text-sm">Postos Atuais</p>
                        <p className="text-[10px] text-gray-400">Rancho, Piscina, Plant√£o, Perman√™ncia</p>
                      </div>
                      {!config.usarPostosNovos&&<Icon name="Check" size={20} className="text-cyan-400"/>}
                    </button>
                    <button onClick={()=>setConfig({...config,usarPostosNovos:true})} className={`w-full p-3 rounded-lg text-left flex items-center justify-between ${config.usarPostosNovos?'bg-cyan-500/20 border border-cyan-500':'bg-gray-800'}`}>
                      <div>
                        <p className="font-bold text-sm">Novos Postos</p>
                        <p className="text-[10px] text-gray-400">Port√£o, Motorizada, Adjunto, Aux Cmt</p>
                      </div>
                      {config.usarPostosNovos&&<Icon name="Check" size={20} className="text-cyan-400"/>}
                    </button>
                  </div>
                </div>

                {/* Info Quartos */}
                <div className="glass rounded-xl p-4 border border-gray-700">
                  <p className="text-xs text-gray-500 mb-3">QUARTOS DE HORA (CICLO 24H)</p>
                  <div className="space-y-2">
                    {QUARTOS.map(q=>(
                      <div key={q.id} className="bg-gray-800/50 rounded-lg p-3">
                        <p className="font-bold text-sm text-white">{q.nome}</p>
                        <p className="text-xs text-cyan-400 font-mono mt-1">{q.horarios}</p>
                      </div>
                    ))}
                  </div>
                  <p className="text-xs text-gray-500 mt-3 text-center">1¬∞‚Üí2¬∞‚Üí3¬∞‚Üí1¬∞‚Üí2¬∞‚Üí3¬∞‚Üí1¬∞‚Üí2¬∞‚Üí3¬∞‚Üí1¬∞‚Üí2¬∞‚Üí3¬∞</p>
                </div>

                {/* Postos dispon√≠veis */}
                <div className="glass rounded-xl p-4 border border-gray-700">
                  <p className="text-xs text-gray-500 mb-3">POSTOS DISPON√çVEIS</p>
                  <div className="space-y-2">
                    {currentPostos.map(p=>(
                      <div key={p.id} className="bg-gray-800/50 rounded-lg p-2 flex items-center gap-2">
                        <Icon name={p.icon} size={16} className="text-amber-400"/>
                        <span className="text-sm">{p.nome}</span>
                      </div>
                    ))}
                  </div>
                </div>

                {/* Limpezas */}
                <div className="glass rounded-xl p-4 border border-gray-700">
                  <p className="text-xs text-gray-500 mb-3">LIMPEZAS (FISCAL)</p>
                  <div className="space-y-2">
                    {LIMPEZAS.map(l=>(
                      <div key={l.id} className="bg-gray-800/50 rounded-lg p-2 flex items-center gap-2">
                        <Icon name={l.icon} size={16} className="text-green-400"/>
                        <span className="text-sm">{l.nome}</span>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            )}
          </div>
        )}

        {tab==='treino'&&(
          <div className="space-y-4">
            <h1 className="text-xl font-orbitron font-bold">TREINO</h1>
            <div className="glass rounded-xl p-6 border border-gray-700 text-center">
              <p className="text-xs text-gray-500 mb-3">HOJE</p>
              <button onClick={()=>togEx(today())} className={`w-20 h-20 rounded-full flex items-center justify-center mx-auto ${hasEscala(today())?'bg-purple-600/30 border-2 border-purple-500':ex.hist.find(h=>h.d===today())?.ok?'bg-green-500':'bg-gray-800 border-2 border-dashed border-gray-600'}`}>
                {hasEscala(today())?<Icon name="Shield" size={32} className="text-purple-400"/>:ex.hist.find(h=>h.d===today())?.ok?<Icon name="Check" size={32}/>:<Icon name="Plus" size={32} className="text-gray-500"/>}
              </button>
              <p className="mt-3 font-bold">{hasEscala(today())?'SERVI√áO':ex.hist.find(h=>h.d===today())?.ok?'COMPLETO':'MARCAR'}</p>
            </div>
            <div className="grid grid-cols-3 gap-3">
              <div className="glass rounded-xl p-3 border border-gray-800 text-center"><p className="text-2xl font-bold text-orange-400">{ex.streak}üî•</p><p className="text-[10px] text-gray-500">STREAK</p></div>
              <div className="glass rounded-xl p-3 border border-gray-800 text-center"><p className="text-2xl font-bold text-purple-400">{ex.best}üëë</p><p className="text-[10px] text-gray-500">RECORDE</p></div>
              <div className="glass rounded-xl p-3 border border-gray-800 text-center"><p className="text-2xl font-bold text-cyan-400">{ex.hist.filter(h=>h.ok).length}</p><p className="text-[10px] text-gray-500">TOTAL</p></div>
            </div>
            <div className="glass rounded-xl p-4 border border-gray-700">
              <p className="text-xs text-gray-500 mb-3">30 DIAS</p>
              <div className="grid grid-cols-7 gap-1">
                {last30().map(d=>(
                  <button key={d.d} onClick={()=>togEx(d.d)} className={`aspect-square rounded text-[10px] font-bold ${d.duty?'bg-purple-600/50 text-purple-300 border border-purple-500':d.ok?'bg-green-500 text-white':'bg-gray-800 text-gray-500'} ${d.d===today()?'ring-2 ring-cyan-500':''}`}>{d.day}</button>
                ))}
              </div>
            </div>
          </div>
        )}

        {tab==='missoes'&&(
          <div className="space-y-4">
            <div className="flex justify-between items-center">
              <div>
                <h1 className="text-xl font-orbitron font-bold">MISS√ïES</h1>
                <p className="text-xs text-gray-500">{tasks.filter(t=>!t.done).length} pendentes</p>
              </div>
              <button onClick={()=>setModal('task')} className="w-10 h-10 rounded-lg bg-cyan-600 flex items-center justify-center"><Icon name="Plus" size={20}/></button>
            </div>
            
            {tasks.length===0?(
              <div className="glass rounded-xl p-8 border border-gray-700 text-center">
                <Icon name="ListTodo" size={40} className="mx-auto text-gray-600 mb-2"/>
                <p className="text-gray-500">Nenhuma miss√£o</p>
              </div>
            ):(
              <div className="space-y-3">
                {sortedTasks.map(t=>{
                  const prio=PRIORITIES[t.priority];
                  const isExp=expandedTask===t.id;
                  return(
                    <div key={t.id} className={`glass rounded-xl border-l-4 ${prio.border} ${t.done?'opacity-50':''} overflow-hidden`}>
                      <div className="p-4">
                        <div className="flex items-start gap-3">
                          <button onClick={()=>togTask(t.id)} className={`mt-0.5 w-6 h-6 rounded-full border-2 flex items-center justify-center flex-shrink-0 ${t.done?'bg-green-500 border-green-500':'border-gray-600 hover:border-green-500'}`}>
                            {t.done&&<Icon name="Check" size={14}/>}
                          </button>
                          <div className="flex-1 min-w-0" onClick={()=>setExpandedTask(isExp?null:t.id)}>
                            <div className="flex items-center gap-2 mb-1">
                              <span className={`text-[10px] px-2 py-0.5 rounded font-bold ${prio.color}`}>{prio.label}</span>
                              {t.penalized&&<span className="text-[10px] px-2 py-0.5 rounded bg-red-500/20 text-red-400">ATRASADA</span>}
                            </div>
                            <p className={`font-bold ${t.done?'line-through text-gray-500':''}`}>{t.title}</p>
                            {t.deadline&&(
                              <p className={`text-xs mt-1 flex items-center gap-1 ${getDeadlineColor(t.deadline,t.done)}`}>
                                <Icon name="Clock" size={12}/> {fmtD(t.deadline)} ‚Ä¢ {getDeadlineText(t.deadline,t.done)}
                              </p>
                            )}
                          </div>
                          <button onClick={()=>setTasks(p=>p.filter(x=>x.id!==t.id))} className="text-gray-500 hover:text-red-400 flex-shrink-0">
                            <Icon name="Trash2" size={16}/>
                          </button>
                        </div>
                        {isExp&&t.desc&&(
                          <div className="mt-3 pt-3 border-t border-gray-700">
                            <p className="text-sm text-gray-400">{t.desc}</p>
                          </div>
                        )}
                        {t.done&&t.completedAt&&(
                          <p className="text-[10px] text-gray-500 mt-2">
                            ‚è± Auto-remove em {Math.max(0,Math.ceil((t.completedAt+600000-Date.now())/60000))} min
                          </p>
                        )}
                      </div>
                    </div>
                  );
                })}
              </div>
            )}
          </div>
        )}

        {tab==='perfil'&&(
          <div className="space-y-4">
            <div className="glass rounded-xl p-6 border border-gray-700">
              <div className="flex items-center gap-4 mb-4">
                <div className="w-16 h-16 rounded-xl flex items-center justify-center text-3xl font-orbitron font-black" style={{backgroundColor:rank.c,boxShadow:`0 0 20px ${rank.c}`}}>{rank.n}</div>
                <div><h2 className="text-xl font-orbitron font-bold" style={{color:rank.c}}>RANK {rank.n}</h2><p className="text-gray-500 text-sm">{rank.t}</p><p className="text-cyan-400 text-sm">LV {data.lv} ‚Ä¢ {data.xp} XP</p></div>
              </div>
              <div className="grid grid-cols-2 gap-3">
                <div className="bg-gray-800/50 rounded-lg p-3 text-center"><p className="text-2xl font-bold text-cyan-400">{data.items.length}</p><p className="text-xs text-gray-500">T√≥picos</p></div>
                <div className="bg-gray-800/50 rounded-lg p-3 text-center"><p className="text-2xl font-bold text-amber-400">{data.items.reduce((a,i)=>a+i.revs.length,0)}</p><p className="text-xs text-gray-500">Revis√µes</p></div>
              </div>
            </div>
            <div className="glass rounded-xl p-4 border border-gray-700">
              <p className="text-xs text-gray-500 mb-3">EBBINGHAUS</p>
              <div className="space-y-2 text-sm">{INT.map((d,i)=>(<div key={i} className="flex justify-between bg-gray-800/50 rounded-lg p-2"><span className="text-gray-400">{i+1}¬™ Rev</span><span className="text-cyan-400">{d}d</span></div>))}</div>
            </div>
            <button onClick={()=>{if(window.confirm('Resetar?')){setData({items:[],xp:0,hp:100,lv:1,debt:0});setEx({hist:[],streak:0,best:0});setTasks([]);setEscalas([]);setConfig({usarPostosNovos:false});}}} className="w-full py-3 rounded-xl bg-red-500/20 text-red-400 border border-red-500/30 font-bold">RESETAR</button>
          </div>
        )}
      </div>

      {/* NAV */}
      <nav className="fixed bottom-0 left-0 right-0 glass border-t border-gray-800">
        <div className="max-w-md mx-auto flex justify-around py-2">
          {[{id:'home',i:'Home',l:'Miss√£o'},{id:'materias',i:'BookOpen',l:'Mat√©rias'},{id:'escalas',i:'CalendarDays',l:'Escalas'},{id:'treino',i:'Dumbbell',l:'Treino'},{id:'missoes',i:'ListTodo',l:'Tarefas'},{id:'perfil',i:'User',l:'Perfil'}].map(({id,i,l})=>(
            <button key={id} onClick={()=>setTab(id)} className={`flex flex-col items-center py-2 px-2 rounded-lg ${tab===id?'text-cyan-400':'text-gray-500'}`}><Icon name={i} size={20}/><span className="text-[9px] mt-1">{l}</span></button>
          ))}
        </div>
      </nav>
    </div>
  );
}
ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
